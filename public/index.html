<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Insert - Offres d'emploi au Niger</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0fff4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                        },
                        secondary: {
                            50: '#fff7ed',
                            100: '#ffedd5',
                            200: '#fed7aa',
                            300: '#fdba74',
                            400: '#fb923c',
                            500: '#f97316',
                            600: '#ea580c',
                            700: '#c2410c',
                            800: '#9a3412',
                            900: '#7c2d12',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: #f8fafc;
            scroll-behavior: smooth;
        }
        
        .card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border-left: 4px solid transparent;
        }
        
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-left-color: #fb923c;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 24px;
            border: none;
            width: 90%;
            max-width: 700px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s ease;
            position: relative;
            max-height: 85vh;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
            position: absolute;
            top: 15px;
            right: 20px;
            z-index: 10;
        }
        
        .close:hover {
            color: #333;
        }
        
        .btn-primary {
            background: #22c55e;
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: #16a34a;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }
        
        .btn-secondary {
            background: #f97316;
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #ea580c;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
        }
        
        .search-input {
            transition: all 0.3s ease;
            border: 2px solid #e2e8f0;
        }
        
        .search-input:focus {
            border-color: #86efac;
            box-shadow: 0 0 0 3px rgba(134, 239, 172, 0.3);
        }
        
        .filter-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            margin-top: 16px;
            color: #475569;
        }
        
        .filter-label i {
            color: #fb923c;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #22c55e;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        .company-logo {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f1f5f9;
            border-radius: 8px;
            font-weight: bold;
            color: #fb923c;
            margin: 0 auto 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .company-logo-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }
        
        .pagination-btn {
            transition: all 0.2s ease;
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination-btn:not(:disabled):hover {
            background-color: #dcfce7;
        }
        
        .tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 500;
            margin-right: 6px;
            margin-bottom: 6px;
        }
        
        .tag-contract {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .tag-sector {
            background-color: #f0fdf4;
            color: #166534;
        }
        
        .tag-location {
            background-color: #ffedd5;
            color: #9a3412;
        }
        
        .tag-date {
            background-color: #fae8ff;
            color: #a21caf;
        }
        
        .tag-views {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .salary {
            font-weight: 600;
            color: #166534;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Styles pour l'analyseur de CV */
        .cv-analyzer {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-top: 2rem;
        }
        
        .analyzer-result {
            margin-top: 1rem;
            font-weight: bold;
            padding: 1rem;
            border-radius: 8px;
            backgroundColor: #f8fafc;
        }
        
        .progress-bar {
            height: 10px;
            border-radius: 5px;
            background-color: #e5e7eb;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 5px;
            background: #22c55e;
            transition: width 0.5s ease;
        }
        
        .keyword-match {
            display: inline;
            background-color: #d1fae5;
            color: #065f46;
            padding: 2px 8px;
            border-radius: 4px;
            margin: 4px 4px 4px 0;
            font-size: 0.875rem;
            white-space: normal;
            word-break: normal;
            overflow-wrap: break-word;
            hyphens: auto;
        }
        
        .missing-keyword {
            display: inline;
            background-color: #fee2e2;
            color: #b91c1c;
            padding: 2px 8px;
            border-radius: 4px;
            margin: 4px 4px 4px 0;
            font-size: 0.875rem;
            white-space: normal;
            word-break: normal;
            overflow-wrap: break-word;
            hyphens: auto;
        }
        
        .score-circle {
            width: 100px;
            height: 100px;
            position: relative;
            margin: 0 auto;
        }
        
        .circle-bg {
            fill: none;
            stroke: #e5e7eb;
            stroke-width: 3.8;
        }
        
        .circle {
            fill: none;
            stroke-width: 3.8;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 0.8s ease;
        }
        
        .circle-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .pdf-upload-container {
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pdf-upload-container:hover {
            border-color: #22c55e;
            background-color: #f0fff4;
        }
        
        .pdf-upload-icon {
            font-size: 3rem;
            color: #22c55e;
            margin-bottom: 10px;
        }
        
        .pdf-preview {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background-color: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .pdf-preview p {
            margin: 5px 0;
        }
        
        .pdf-extracted-text {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e2e8f0;
            margin-top: 10px;
            font-size: 0.875rem;
            white-space: pre-wrap;
            word-break: break-word;
            overflow-wrap: break-word;
        }
        
        .job-match-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #22c55e;
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .cv-info-form {
            background-color: #f0fff4;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #22c55e;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #374151;
        }
        
        .form-select, .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .form-select:focus, .form-input:focus {
            outline: none;
            border-color: #22c55e;
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
        }
        
        .required-field::after {
            content: '*';
            color: #ef4444;
            margin-left: 3px;
        }
        
        .site-logo {
            height: 40px;
            width: auto;
            object-fit: contain;
        }
        
        /* Styles pour le compteur global */
        .global-counter {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
            animation: pulse 2s infinite;
        }
        
        .counter-container {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 1000;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @media (max-width: 768px) {
            .counter-container {
                position: static;
                text-align: center;
                margin: 10px 0;
            }
            
            .global-counter {
                display: inline-flex;
                margin: 0 auto;
            }
            
            .hero-content {
                flex-direction: column;
            }
            
            .search-input, .search-btn {
                width: 100%;
            }
            
            .cv-analyzer {
                padding: 1rem;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }
            
            .site-logo {
                height: 35px;
            }
            
            /* Correction pour l'affichage du nom et slogan en mobile */
            .mobile-brand {
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
                margin-bottom: 10px;
            }
            
            .mobile-brand .text-2xl {
                font-size: 1.5rem;
            }
            
            .mobile-brand .text-sm {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body class="font-sans bg-gray-50">
    <!-- Compteur global en temps réel -->
    <div class="counter-container">
        <div class="global-counter" id="globalCounter">
            <i class="fas fa-globe-africa"></i>
            <span id="counterValue">Chargement...</span>
            <i class="fas fa-users"></i>
        </div>
    </div>

    <header class="bg-white shadow-sm sticky top-0 z-40">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center">
                <div class="flex items-center">
                    <img id="site-logo" src="/img/logo.png" alt="Smart Insert" class="site-logo mr-2">
                    <div class="text-2xl font-bold text-orange-400 hidden md:block">Smart Insert</div>
                </div>
                <div class="ml-2 text-sm text-gray-600 hidden md:block" id="site-slogan">Votre carrière commence ici</div>
            </div>
            
            <!-- Affichage mobile du nom et slogan -->
            <div class="md:hidden mobile-brand">
                <div class="text-2xl font-bold text-orange-400">Smart Insert</div>
                <div class="text-sm text-gray-600" id="mobile-slogan">Votre carrière commence ici</div>
            </div>
            
            <nav class="hidden md:flex items-center gap-6">
                <a class="text-sm font-medium hover:text-orange-400 transition-colors" href="#offres">Offres</a>
                <a class="text-sm font-medium hover:text-orange-400 transition-colors" href="#entreprises">Entreprises</a>
                <a class="text-sm font-medium hover:text-orange-400 transition-colors" href="#conseils">Conseils</a>
                <a class="text-sm font-medium hover:text-orange-400 transition-colors" href="#analyse-cv">Analyse CV</a>
                <a id="whatsapp-contact" href="https://wa.me/22790143507?text=Je%20suis%20intéressé%20par%20vos%20services" class="ml-2 px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium flex items-center">
                    <i class="fab fa-whatsapp mr-2"></i> Contact
                </a>
                <div data-netlify-identity-menu></div>
            </nav>
            
            <button class="md:hidden text-gray-600" id="mobileMenuBtn">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>
        
        <!-- Menu mobile -->
        <div class="md:hidden bg-white shadow-md hidden" id="mobileMenu">
            <div class="container mx-auto px-4 py-3 flex flex-col space-y-3">
                <a class="text-sm font-medium hover:text-orange-400 py-2" href="#offres">Offres d'emploi</a>
                <a class="text-sm font-medium hover:text-orange-400 py-2" href="#entreprises">Entreprises</a>
                <a class="text-sm font-medium hover:text-orange-400 py-2" href="#conseils">Conseils CV</a>
                <a class="text-sm font-medium hover:text-orange-400 py-2" href="#analyse-cv">Analyse CV</a>
                <a id="whatsapp-contact-mobile" href="https://wa.me/22790143507?text=Je%20suis%20intéressé%20par%20vos%20services" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium text-center">
                    Contact WhatsApp
                </a>
                <div data-netlify-identity-menu></div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- Section Hero - Texte modifié -->
        <section class="bg-gradient-to-r from-green-600 to-green-800 text-white rounded-2xl p-8 mb-8 shadow-lg">
            <div class="max-w-4xl mx-auto">
                <h1 class="text-3xl md:text-4xl font-bold mb-4 text-orange-300">Bienvenue chez Smart Insert</h1>
                <p class="mb-6 text-lg opacity-90">Des centaines d'offres d'emploi dans tous les secteurs. Filtrez par mot-clé, lieu ou entreprise.</p>
                
                <div class="bg-white p-2 rounded-lg shadow-inner">
                    <form id="searchForm" class="flex flex-col md:flex-row gap-2">
                        <div class="flex-1 flex flex-col md:flex-row gap-2">
                            <div class="relative flex-1">
                                <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                                <input id="q" type="search" placeholder="Métier, compétence ou entreprise" class="pl-10 pr-4 py-3 rounded-lg border-0 search-input text-gray-800 w-full" />
                            </div>
                            <div class="relative flex-1">
                                <i class="fas fa-map-marker-alt absolute left-3 top-3.5 text-gray-400"></i>
                                <input id="location" type="text" placeholder="Ville ou région" class="pl-10 pr-4 py-3 rounded-lg border-0 search-input text-gray-800 w-full" />
                            </div>
                        </div>
                        <button type="submit" class="px-6 py-3 bg-green-600 text-white rounded-lg font-medium flex items-center justify-center">
                            <i class="fas fa-search mr-2"></i> Rechercher
                        </button>
                    </form>
                </div>
                
                <div class="mt-4 flex flex-wrap gap-2">
                    <span class="text-sm opacity-80">Suggestions :</span>
                    <button class="text-sm bg-white/20 hover:bg-white/30 px-3 py-1 rounded-full transition-colors suggestion-btn" data-suggestion="Agent de terrain">Agent de terrain</button>
                    <button class="text-sm bg-white/20 hover:bg-white/30 px-3 py-1 rounded-full transition-colors suggestion-btn" data-suggestion="Chargé de projet">Chargé de projet</button>
                    <button class="text-sm bg-white/20 hover:bg-white/30 px-3 py-1 rounded-full transition-colors suggestion-btn" data-suggestion="Niamey">Niamey</button>
                </div>
            </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Sidebar -->
            <aside class="lg:col-span-1">
                <div class="bg-white rounded-xl p-5 shadow-sm border border-gray-100">
                    <h3 class="font-semibold text-lg flex items-center">
                        <i class="fas fa-filter mr-2 text-orange-400"></i> Filtres
                    </h3>
                    
                    <div class="filter-label">
                        <i class="fas fa-file-contract text-orange-400"></i>
                        <span>Type de contrat</span>
                    </div>
                    <select id="contract" class="w-full p-3 border rounded-lg mt-1 search-input">
                        <option value="">Tous les contrats</option>
                        <option>CDD</option>
                        <option>CDI</option>
                        <option>Stage</option>
                        <option>Consultant</option>
                        <option>Freelance</option>
                    </select>
                    
                    <div class="filter-label">
                        <i class="fas fa-industry text-orange-400"></i>
                        <span>Secteur d'activité</span>
                    </div>
                    <select id="sector" class="w-full p-3 border rounded-lg mt-1 search-input">
                        <option value="">Tous les secteurs</option>
                        <option>Humanitaire</option>
                        <option>Agriculture</option>
                        <option>Éducation</option>
                        <option>Santé</option>
                        <option>Services</option>
                        <option>Commerce</option>
                        <option>Construction</option>
                        <option>Technologie</option>
                    </select>
                    
                    <div class="filter-label">
                        <i class="fas fa-calendar-alt text-orange-400"></i>
                        <span>Date de publication</span>
                    </div>
                    <select id="datePosted" class="w-full p-3 border rounded-lg mt-1 search-input">
                        <option value="">Toutes les dates</option>
                        <option value="7">Il y a moins d'une semaine</option>
                        <option value="30">Il y a moins d'un mois</option>
                        <option value="90">Il y a moins de 3 mois</option>
                    </select>
                    
                    <div class="mt-5 flex justify-between">
                        <button id="applyFilters" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm">
                            Appliquer
                        </button>
                        <button id="clearFilters" class="px-4 py-2 border border-gray-300 text-gray-600 rounded-lg text-sm hover:bg-gray-50">
                            Tout effacer
                        </button>
                    </div>
                </div>
                
                <div class="mt-6 bg-white rounded-xl p-5 shadow-sm border border-gray-100">
                    <h4 class="font-semibold text-lg flex items-center">
                        <i class="fas fa-building mr-2 text-orange-400"></i> Entreprises populaires
                    </h4>
                    <ul class="mt-4 space-y-3" id="popular-companies">
                        <!-- Les entreprises populaires seront chargées ici -->
                    </ul>
                </div>
                
                <div class="mt-6 bg-green-50 rounded-xl p-5 border border-green-100">
                    <h4 class="font-semibold text-lg flex items-center text-green-700">
                        <i class="fas fa-bell mr-2"></i> Alertes emploi
                    </h4>
                    <p class="mt-2 text-sm text-green-600">Recevez les nouvelles offres - s'inscrire</p>
                    <div class="mt-3">
                        <a id="whatsapp-alerts" href="https://wa.me/22790143507?text=Je%20souhaite%20recevoir%20des%20alertes%20emploi%20sur%20WhatsApp" class="mt-2 w-full px-4 py-2 bg-green-600 text-white rounded-lg text-sm block text-center">
                            S'inscrire via WhatsApp
                        </a>
                    </div>
                </div>
            </aside>

            <!-- Job list -->
            <section id="offres" class="lg:col-span-3">
                <div class="flex flex-col md:flex-row items-center justify-between mb-6">
                    <h3 class="text-xl font-semibold flex items-center">
                        <i class="fas fa-briefcase mr-2 text-orange-400"></i> Offres d'emploi
                    </h3>
                    <div class="text-sm text-gray-600 mt-2 md:mt-0">
                        <span id="count">0</span> offres trouvées
                        <span id="filterIndicator" class="hidden ml-2 bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs"></span>
                    </div>
                </div>
                
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p class="mt-3 text-gray-600">Recherche en cours...</p>
                </div>
                
                <div id="jobs" class="grid grid-cols-1 gap-4"></div>
                
                <!-- Pagination -->
                <div class="mt-8 flex justify-center items-center space-x-4">
                    <button id="prev" class="pagination-btn px-4 py-2 rounded-lg border border-gray-300 text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center">
                        <i class="fas fa-chevron-left mr-2 text-xs"></i> Précédent
                    </button>
                    <span class="text-sm text-gray-600" id="paginationInfo">Page 1 sur 1</span>
                    <button id="next" class="pagination-btn px-4 py-2 rounded-lg border border-gray-300 text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center">
                        Suivant <i class="fas fa-chevron-right ml-2 text-xs"></i>
                    </button>
                </div>
            </section>
        </div>

        <!-- Section Analyse de CV -->
        <section id="analyse-cv" class="mt-16 py-8">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-search mr-3 text-orange-400"></i> Analysez votre CV
            </h2>
            <div class="cv-analyzer">
                <p class="text-gray-700 mb-4">Téléchargez votre CV en format PDF ou collez le texte de votre CV, ainsi que la description du poste pour obtenir une analyse détaillée de correspondance.</p>
                
                <!-- Fiche d'informations obligatoire -->
                <div class="cv-info-form" id="cvInfoForm">
                    <h3 class="text-lg font-semibold mb-4 text-green-700">
                        <i class="fas fa-info-circle mr-2"></i> Informations requises pour l'analyse
                    </h3>
                    <p class="text-sm text-gray-600 mb-4">Ces informations nous aideront à améliorer la précision de l'analyse de votre CV.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-group">
                            <label class="form-label required-field">Niveau d'études</label>
                            <select id="education-level" class="form-select" required>
                                <option value="">Sélectionnez votre niveau</option>
                                <option value="CFEPD">CFEPD</option>
                                <option value="BEPC">BEPC</option>
                                <option value="BAC">BAC</option>
                                <option value="BTS">BTS</option>
                                <option value="LICENCE">LICENCE</option>
                                <option value="MASTER">MASTER</option>
                                <option value="DOCTORAT">DOCTORAT</option>
                                <option value="AUTRE">Autre</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required-field">Années d'expérience (en lien avec le poste)</label>
                            <input type="number" id="years-experience" class="form-input" min="0" max="50" step="0.5" placeholder="Ex: 3.5" required>
                        </div>
                    </div>
                    
                    <button id="submit-cv-info" class="mt-4 px-6 py-3 bg-green-600 text-white rounded-lg font-medium">
                        Valider et continuer
                    </button>
                </div>
                
                <div id="cv-analysis-content" class="hidden">
                    <div class="pdf-upload-container" id="pdfUploadContainer">
                        <div class="pdf-upload-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <p class="font-medium">Déposez votre CV PDF ici ou cliquez pour parcourir</p>
                        <p class="text-sm text-gray-500 mt-1">Supporté: PDF (max. 5MB)</p>
                        <input type="file" id="cv-pdf" accept=".pdf" class="hidden">
                    </div>
                    
                    <div id="pdf-preview" class="pdf-preview">
                        <div class="flex justify-between items-center">
                            <p class="font-medium">Fichier sélectionné: <span id="pdf-filename"></span></p>
                            <button id="remove-pdf" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="mt-2">
                            <p class="text-sm text-gray-600">Texte extrait:</p>
                            <div id="pdf-extracted-text" class="pdf-extracted-text"></div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700">Ou collez le texte de votre CV</label>
                        <textarea id="cv-text" class="w-full p-3 border rounded-lg mt-1 search-input" placeholder="Collez votre CV ici..." rows="8"></textarea>
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700">Description du poste</label>
                        <textarea id="job-desc" class="w-full p-3 border rounded-lg mt-1 search-input" placeholder="Description du poste..." rows="4"></textarea>
                    </div>
                    
                    <button id="analyze-btn" class="mt-4 px-6 py-3 bg-green-600 text-white rounded-lg font-medium">Analyser la correspondance</button>
                </div>
                
                <div id="analyzer-result" class="analyzer-result hidden">
                    <div class="text-center mb-6">
                        <div class="score-circle">
                            <svg viewBox="0 0 36 36" class="circular-chart">
                                <path class="circle-bg"
                                    d="M18 2.0845
                                    a 15.9155 15.9155 0 0 1 0 31.831
                                    a 15.9155 15.9155 0 0 1 0 -31.831"
                                />
                                <path class="circle" stroke="#22c55e"
                                    stroke-dasharray="0, 100"
                                    d="M18 2.0845
                                    a 15.9155 15.9155 0 0 1 0 31.831
                                    a 15.9155 15.9155 0 0 1 0 -31.831"
                                />
                            </svg>
                            <div class="circle-value">0%</div>
                        </div>
                        <h3 class="text-xl font-semibold mt-2">Score de correspondance</h3>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold mb-2">📊 Mots-clés correspondants</h4>
                            <div id="matched-keywords"></div>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">⚠️ Mots-clés manquants</h4>
                            <div id="missing-keywords"></div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="font-semibold mb-2">📈 Analyse détaillée</h4>
                        <div id="detailed-analysis"></div>
                    </div>
                    
                    <div class="mt-6 bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold mb-2 text-blue-800">💡 Conseils d'amélioration</h4>
                        <ul id="improvement-tips" class="list-disc pl-5 text-blue-700"></ul>
                    </div>
                    
                    <div class="mt-6 flex justify-end">
                        <button id="save-result-btn" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium flex items-center">
                            <i class="fas fa-save mr-2"></i> Enregistrer le résultat
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section Entreprises -->
        <section id="entreprises" class="mt-16 py-8">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-building mr-3 text-orange-400"></i> Entreprises partenaires
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="entreprises-container">
                <!-- Les entreprises seront chargées ici dynamiquement -->
            </div>
        </section>

        <!-- Section Conseils -->
        <section id="conseils" class="mt-16 py-8">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-graduation-cap mr-3 text-orange-400"></i> Conseils pour votre recherche
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                    <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-file-alt text-orange-400"></i>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">Structurez votre CV</h3>
                    <p class="text-gray-700">Un bon CV doit être clair, concis et mettre en valeur vos compétences principales. Adaptez-le à chaque offre.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                    <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-clipboard-list text-orange-400"></i>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">Lettre de motivation</h3>
                    <p class="text-gray-700">Personnalisez votre lettre pour chaque emploi. Montrez votre intérêt spécifique pour l'entreprise et le poste.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                    <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-handshake text-orange-400"></i>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">Préparation entretien</h3>
                    <p class="text-gray-700">Anticipez les questions, renseignez-vous sur l'entreprise et préparez vos propres questions pour l'employeur.</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-12 mt-16">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <img id="footer-logo" src="/img/logo.png" alt="Smart Insert" class="h-8 mr-2">
                        <span>Smart Insert</span>
                    </h3>
                    <p class="text-sm text-gray-400" id="footer-slogan">Votre plateforme d'emploi au Niger. Nous connectons les talents aux meilleures opportunités.</p>
                </div>
                
                <div>
                    <h4 class="text-md font-semibold mb-4">Navigation</h4>
                    <ul class="space-y-2">
                        <li><a href="#offres" class="text-sm text-gray-300 hover:text-white transition-colors">Offres d'emploi</a></li>
                        <li><a href="#entreprises" class="text-sm text-gray-300 hover:text-white transition-colors">Entreprises</a></li>
                        <li><a href="#conseils" class="text-sm text-gray-300 hover:text-white transition-colors">Conseils CV</a></li>
                        <li><a href="#analyse-cv" class="text-sm text-gray-300 hover:text-white transition-colors">Analyse CV</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-md font-semibold mb-4">Légal</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-sm text-gray-300 hover:text-white transition-colors" id="conditionsLink">Conditions d'utilisation</a></li>
                        <li><a href="#" class="text-sm text-gray-300 hover:text-white transition-colors" id="privacyLink">Politique de confidentialité</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-md font-semibold mb-4">Contact</h4>
                    <div class="flex items-center mb-2">
                        <i class="fab fa-whatsapp mr-2 text-gray-300"></i>
                        <a id="footer-whatsapp" href="https://wa.me/22790143507" class="text-sm text-gray-300 hover:text-white transition-colors">+227 90 14 35 07</a>
                    </div>
                    <div class="flex items-center mb-2">
                        <i class="fas fa-envelope mr-2 text-gray-300"></i>
                        <span id="footer-email" class="text-sm text-gray-300">abdoulazizeaboubacare@yahoo.fr</span>
                    </div>
                    <div class="flex items-center mt-4 space-x-3">
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>
            
            <div class="mt-10 pt-8 border-t border-gray-700 text-center text-sm text-gray-400">
                © <span id="year"></span> Smart Insert. Tous droits réservés.
                <!-- Compteur global dans le footer -->
                <div class="mt-4" id="footerCounter">
                    <span class="global-counter" style="background: #4b5563; box-shadow: none;">
                        <i class="fas fa-eye"></i>
                        <span id="footerCounterValue">Chargement...</span> vues globales
                    </span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal Conditions d'utilisation -->
    <div id="conditionsModal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="conditionsModal">&times;</span>
            <h2 class="text-2xl font-bold mb-4">Conditions d'utilisation</h2>
            <div class="text-gray-700">
                <p class="mb-4">En utilisant ce site, vous accepte les conditions suivantes :</p>
                <ul class="list-disc pl-5 space-y-2">
                    <li>Le site Smart Insert est une plateforme de mise en relation entre chercheurs d'emploi et employeurs</li>
                    <li>Les offres d'emploi sont publiées sous la responsabilité des recruteurs</li>
                    <li>Smart Insert ne garantit pas l'authenticité des offres mais s'efforce de vérifier leur validité</li>
                    <li>L'utilisation des données personnelles est régie par notre politique de confidentialité</li>
                    <li>Smart Insert se réserve le droit de modifier ces conditions à tout moment</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Modal Politique de confidentialité -->
    <div id="privacyModal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="privacyModal">&times;</span>
            <h2 class="text-2xl font-bold mb-4">Politique de confidentialité</h2>
            <div class="text-gray-700">
                <p class="mb-4">Chez Smart Insert, nous prenons la protection de vos données personnelles très au sérieux :</p>
                <ul class="list-disc pl-5 space-y-2">
                    <li>Nous collectons uniquement les informations nécessaires à la mise en relation avec les employeurs</li>
                    <li>Vos données ne sont pas soldes à des tiers à des fins commerciales</li>
                    <li>Les CV et informations personnelles sont accessibles uniquement aux recruteurs pour lesquels vous postulez</li>
                    <li>Vous pouvez à tout moment demander la suppression de vos données personnelles</li>
                    <li>Nous utilisons des technologies de cryptage pour protéger vos informations</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Données des offres d'emploi (seront chargées via fetch)
        let JOBS = [];
        let jobsLoaded = false;
        let SETTINGS = {};
        let PARTNER_ENTERPRISES = [];

        // État de l'application
        let currentPage = 1;
        const jobsPerPage = 4;
        let filteredJobs = [];
        let activeFilters = {};
        let currentAnalysisResult = null;
        let currentJobIdForAnalysis = null;
        let userEducationLevel = '';
        let userExperienceYears = 0;

        // Variables pour le compteur global
        let globalViewCount = 0;
        let counterUpdateInterval;

        // ==============================================
        // FONCTIONS POUR LE COMPTEUR GLOBAL
        // ==============================================

        // Fonction pour incrémenter le compteur global
        async function incrementGlobalCounter() {
            try {
                const response = await fetch('/.netlify/functions/compteur', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.count) {
                    globalViewCount = data.count;
                    updateCounterDisplay();
                    return data.count;
                }
            } catch (error) {
                console.error('Erreur lors de l\'incrémentation du compteur:', error);
                // En cas d'erreur, on essaie de récupérer la valeur actuelle
                await getCurrentCounter();
            }
            return 0;
        }

        // Fonction pour récupérer la valeur actuelle du compteur
        async function getCurrentCounter() {
            try {
                const response = await fetch('/.netlify/functions/get-compteur');
                
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.count !== undefined) {
                    globalViewCount = data.count;
                    updateCounterDisplay();
                    return data.count;
                }
            } catch (error) {
                console.error('Erreur lors de la récupération du compteur:', error);
            }
            return 0;
        }

        // Fonction pour mettre à jour l'affichage du compteur
        function updateCounterDisplay() {
            // Formater le nombre avec des séparateurs de milliers
            const formattedCount = new Intl.NumberFormat('fr-FR').format(globalViewCount);
            
            // Mettre à jour le compteur flottant
            const counterElement = document.getElementById('counterValue');
            if (counterElement) {
                counterElement.textContent = `${formattedCount} visites`;
            }
            
            // Mettre à jour le compteur dans le footer
            const footerCounterElement = document.getElementById('footerCounterValue');
            if (footerCounterElement) {
                footerCounterElement.textContent = formattedCount;
            }
        }

        // Fonction pour démarrer la mise à jour périodique du compteur
        function startCounterUpdates() {
            // Mettre à jour le compteur toutes les 30 secondes
            counterUpdateInterval = setInterval(getCurrentCounter, 30000);
        }

        // Fonction pour arrêter la mise à jour périodique
        function stopCounterUpdates() {
            if (counterUpdateInterval) {
                clearInterval(counterUpdateInterval);
            }
        }

        // ==============================================
        // FONCTIONS EXISTANTES (CONSERVÉES)
        // ==============================================

        // Fonctions pour gérer les vues des offres
        function getJobViews(jobId) {
            const jobViews = JSON.parse(localStorage.getItem('jobViews') || '{}');
            return jobViews[jobId] || 0;
        }

        function incrementJobViews(jobId) {
            const jobViews = JSON.parse(localStorage.getItem('jobViews') || '{}');
            jobViews[jobId] = (jobViews[jobId] || 0) + 1;
            localStorage.setItem('jobViews', JSON.stringify(jobViews));
            return jobViews[jobId];
        }

        function updateJobViewsDisplay(jobId, viewsCount) {
            const jobCards = document.querySelectorAll(`[data-job-id="${jobId}"]`);
            jobCards.forEach(card => {
                const viewsElement = card.querySelector('.job-views');
                if (viewsElement) {
                    viewsElement.textContent = `${viewsCount} vue${viewsCount > 1 ? 's' : ''}`;
                }
            });
            
            const modal = document.querySelector('.modal');
            if (modal && modal.style.display === 'block') {
                const modalViewsElement = modal.querySelector('.modal-job-views');
                if (modalViewsElement) {
                    modalViewsElement.textContent = `${viewsCount} vue${viewsCount > 1 ? 's' : ''}`;
                }
            }
        }

        // Fonction pour charger les paramètres du site
        async function loadSettings() {
            try {
                const response = await fetch('/data/settings.json');
                const data = await response.json();
                SETTINGS = data;
                
                if (data.site_logo) {
                    document.getElementById('site-logo').src = data.site_logo;
                    document.getElementById('footer-logo').src = data.site_logo;
                }
                
                if (data.site_name) {
                    document.querySelector('.text-2xl.font-bold.text-orange-400').textContent = data.site_name;
                    document.querySelector('footer h3 span').textContent = data.site_name;
                    document.title = data.site_name + ' - Offres d\'emploi au Niger';
                }
                
                if (data.slogan) {
                    document.getElementById('site-slogan').textContent = data.slogan;
                    document.getElementById('footer-slogan').textContent = data.slogan;
                    document.getElementById('mobile-slogan').textContent = data.slogan;
                }
                
                if (data.whatsapp_contact) {
                    const whatsappNumber = data.whatsapp_contact.replace(/\D/g, '');
                    const whatsappUrl = `https://wa.me/${whatsappNumber}?text=Je%20suis%20intéressé%20par%20vos%20services`;
                    
                    document.getElementById('whatsapp-contact').href = whatsappUrl;
                    document.getElementById('whatsapp-contact-mobile').href = whatsappUrl;
                    document.getElementById('whatsapp-alerts').href = `https://wa.me/${whatsappNumber}?text=Je%20souhaite%20recevoir%20des%20alertes%20emploi%20sur%20WhatsApp`;
                    document.getElementById('footer-whatsapp').href = `https://wa.me/${whatsappNumber}`;
                    document.getElementById('footer-whatsapp').textContent = data.whatsapp_contact;
                }
                
                if (data.email_contact) {
                    document.getElementById('footer-email').textContent = data.email_contact;
                }
                
            } catch (error) {
                console.error('Erreur lors du chargement des paramètres:', error);
            }
        }

        // Fonction pour charger les entreprises partenaires
        async function loadPartnerEnterprises() {
            try {
                const response = await fetch('/data/entreprises.json');
                const data = await response.json();
                
                if (Array.isArray(data.entreprises)) {
                    PARTNER_ENTERPRISES = data.entreprises;
                } else if (Array.isArray(data)) {
                    PARTNER_ENTERPRISES = data;
                } else {
                    PARTNER_ENTERPRISES = [];
                }
                
                const container = document.getElementById('entreprises-container');
                container.innerHTML = '';
                
                if (PARTNER_ENTERPRISES.length === 0) {
                    container.innerHTML = '<p class="col-span-4 text-center text-gray-500">Aucune entreprise partenaire pour le moment.</p>';
                    return;
                }
                
                PARTNER_ENTERPRISES.forEach(entreprise => {
                    const div = document.createElement('div');
                    div.className = 'bg-white p-6 rounded-xl shadow-sm text-center border border-gray-100 hover:shadow-md transition-shadow';
                    
                    if (entreprise.logo) {
                        div.innerHTML = `
                            <img src="${entreprise.logo}" alt="${entreprise.name}" class="company-logo-img mx-auto mb-4">
                            <h3 class="font-semibold">${entreprise.name}</h3>
                            ${entreprise.description ? `<p class="text-sm text-gray-600 mt-2">${entreprise.description}</p>` : ''}
                        `;
                    } else {
                        div.innerHTML = `
                            <div class="company-logo">${entreprise.name.substring(0, 2).toUpperCase()}</div>
                            <h3 class="font-semibold">${entreprise.name}</h3>
                            ${entreprise.description ? `<p class="text-sm text-gray-600 mt-2">${entreprise.description}</p>` : ''}
                        `;
                    }
                    
                    container.appendChild(div);
                });
                
                const popularContainer = document.getElementById('popular-companies');
                popularContainer.innerHTML = '';
                
                PARTNER_ENTERPRISES.slice(0, 5).forEach(entreprise => {
                    const li = document.createElement('li');
                    li.className = 'flex items-center py-2 border-b border-gray-100';
                    
                    if (entreprise.logo) {
                        li.innerHTML = `
                            <img src="${entreprise.logo}" alt="${entreprise.name}" class="w-8 h-8 rounded-full object-cover mr-3">
                            <span class="text-gray-700">${entreprise.name}</span>
                        `;
                    } else {
                        li.innerHTML = `
                            <div class="w-8 h-8 bg-orange-50 rounded-full flex items-center justify-center mr-3">
                                <span class="text-orange-400 font-bold text-sm">${entreprise.name.substring(0, 1).toUpperCase()}</span>
                            </div>
                            <span class="text-gray-700">${entreprise.name}</span>
                        `;
                    }
                    
                    popularContainer.appendChild(li);
                });
                
            } catch (error) {
                console.error('Erreur lors du chargement des entreprises partenaires:', error);
                document.getElementById('entreprises-container').innerHTML = '<p class="col-span-4 text-center text-gray-500">Erreur lors du chargement des entreprises.</p>';
            }
        }

        // Fonction pour charger les offres d'emploi depuis le fichier JSON
        async function loadJobsFromJSON() {
            try {
                document.querySelector('.loading').style.display = 'block';
                document.getElementById('jobs').innerHTML = '';
                
                console.log('Chargement des offres depuis /data/content.json...');
                const jobsResponse = await fetch('/data/content.json');
                
                if (!jobsResponse.ok) {
                    throw new Error(`Erreur HTTP: ${jobsResponse.status}`);
                }
                
                const jobsData = await jobsResponse.json();
                console.log('Données brutes reçues:', jobsData);
                
                if (jobsData.content && Array.isArray(jobsData.content)) {
                    JOBS = jobsData.content;
                } else if (Array.isArray(jobsData)) {
                    JOBS = jobsData;
                } else {
                    JOBS = Object.values(jobsData).filter(item => 
                        item && typeof item === 'object' && item.title
                    );
                }
                
                console.log(`${JOBS.length} offres d'emploi trouvées`);
                
                JOBS = JOBS.map((job, index) => {
                    if (!job.id) {
                        job.id = 'job-' + (index + 1) + '-' + Date.now();
                    }
                    if (!Array.isArray(job.skills)) {
                        if (typeof job.skills === 'string') {
                            job.skills = job.skills.split(',').map(s => s.trim()).filter(s => s);
                        } else {
                            job.skills = [];
                        }
                    }
                    return job;
                });
                
                JOBS.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                filteredJobs = [...JOBS];
                jobsLoaded = true;
                
                renderJobs(filteredJobs);
                updatePagination();
                
                document.querySelector('.loading').style.display = 'none';
                
                console.log(`${JOBS.length} offres d'emploi chargées avec succès`);
                
            } catch (error) {
                console.error('Erreur lors du chargement des offres:', error);
                
                document.getElementById('jobs').innerHTML = `
                    <div class="bg-white rounded-xl p-8 text-center shadow-sm border border-gray-100">
                        <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
                        <h3 class="text-lg font-semibold text-gray-700">Aucune offre disponible</h3>
                        <p class="text-gray-500 mt-2">Il n'y a actuellement aucune offre d'emploi disponible. Veuillez réessayer plus tard.</p>
                        <button class="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg text-sm" onclick="loadJobsFromJSON()">
                            <i class="fas fa-redo mr-2"></i> Réessayer
                        </button>
                    </div>
                `;
                
                document.querySelector('.loading').style.display = 'none';
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Initialiser l'année du copyright
            document.getElementById('year').textContent = new Date().getFullYear();
            
            // Initialiser le compteur global
            initializeGlobalCounter();
            
            // Charger les paramètres du site
            loadSettings();
            
            // Charger les entreprises partenaires
            loadPartnerEnterprises();
            
            // Charger les offres d'emploi
            loadJobsFromJSON();
            
            // Configurer les événements
            setupEventListeners();
            
            // Configurer le menu mobile
            setupMobileMenu();
            
            // Configurer l'analyseur de CV
            setupCVAnalyzer();
            
            // Configurer le téléchargement PDF
            setupPDFUpload();
            
            // Initialiser Netlify Identity avec redirection automatique
            if (window.netlifyIdentity) {
                window.netlifyIdentity.on("init", user => {
                    if (!user) {
                        window.netlifyIdentity.on("login", () => {
                            document.location.href = "/admin/";
                        });
                    } else {
                        document.location.href = "/admin/";
                    }
                });
            }
        }

        // Fonction d'initialisation du compteur global
        async function initializeGlobalCounter() {
            // Incrémenter le compteur dès l'arrivée sur le site
            await incrementGlobalCounter();
            
            // Démarrer les mises à jour périodiques
            startCounterUpdates();
        }

        function setupEventListeners() {
            // Recherche
            document.getElementById('searchForm').addEventListener('submit', function(e) {
                e.preventDefault();
                filterJobs();
            });
            
            // Filtres
            document.getElementById('applyFilters').addEventListener('click', filterJobs);
            document.getElementById('clearFilters').addEventListener('click', clearFilters);
            
            // Pagination
            document.getElementById('prev').addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    renderJobs(filteredJobs);
                    updatePagination();
                    window.scrollTo({ top: document.getElementById('offres').offsetTop - 100, behavior: 'smooth' });
                }
            });
            
            document.getElementById('next').addEventListener('click', function() {
                const maxPage = Math.ceil(filteredJobs.length / jobsPerPage);
                if (currentPage < maxPage) {
                    currentPage++;
                    renderJobs(filteredJobs);
                    updatePagination();
                    window.scrollTo({ top: document.getElementById('offres').offsetTop - 100, behavior: 'smooth' });
                }
            });
            
            // Suggestions de recherche
            document.querySelectorAll('.suggestion-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const suggestion = this.getAttribute('data-suggestion');
                    document.getElementById('q').value = suggestion;
                    filterJobs();
                });
            });
            
            // Modales
            document.getElementById('conditionsLink').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('conditionsModal').style.display = 'block';
            });
            
            document.getElementById('privacyLink').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('privacyModal').style.display = 'block';
            });
            
            document.querySelectorAll('.close').forEach(closeBtn => {
                closeBtn.addEventListener('click', function() {
                    const modalId = this.getAttribute('data-modal');
                    document.getElementById(modalId).style.display = 'none';
                });
            });
            
            // Fermer les modales en cliquant à l'extérieur
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
        }

        function setupMobileMenu() {
            const menuBtn = document.getElementById('mobileMenuBtn');
            const mobileMenu = document.getElementById('mobileMenu');
            
            menuBtn.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
            });
            
            mobileMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', function() {
                    mobileMenu.classList.add('hidden');
                });
            });
        }

        function setupCVAnalyzer() {
            document.getElementById('submit-cv-info').addEventListener('click', validateCVInfoForm);
            document.getElementById('analyze-btn').addEventListener('click', analyzeCV);
            document.getElementById('save-result-btn').addEventListener('click', saveAnalysisResult);
        }

        function setupPDFUpload() {
            const pdfInput = document.getElementById('cv-pdf');
            const pdfUploadContainer = document.getElementById('pdfUploadContainer');
            const pdfPreview = document.getElementById('pdf-preview');
            const removePdfBtn = document.getElementById('remove-pdf');
            
            pdfUploadContainer.addEventListener('click', function() {
                pdfInput.click();
            });
            
            pdfInput.addEventListener('change', function(e) {
                if (this.files && this.files[0]) {
                    const file = this.files[0];
                    
                    if (file.size > 5 * 1024 * 1024) {
                        alert('Le fichier est trop volumineux. Taille maximale: 5MB');
                        this.value = '';
                        return;
                    }
                    
                    document.getElementById('pdf-filename').textContent = file.name;
                    pdfPreview.style.display = 'block';
                    
                    extractTextFromPDF(file).then(text => {
                        document.getElementById('pdf-extracted-text').textContent = text;
                        document.getElementById('cv-text').value = text;
                    }).catch(error => {
                        console.error('Erreur lors de l\'extraction du texte:', error);
                        document.getElementById('pdf-extracted-text').textContent = 'Impossible d\'extraire le texte de ce PDF. Veuillez coller le texte manuellement.';
                    });
                }
            });
            
            removePdfBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                pdfInput.value = '';
                pdfPreview.style.display = 'none';
                document.getElementById('cv-text').value = '';
            });
        }

        function validateCVInfoForm() {
            const educationLevel = document.getElementById('education-level').value;
            const yearsExperience = document.getElementById('years-experience').value;
            
            if (!educationLevel) {
                alert('Veuillez sélectionner votre niveau d\'études.');
                return;
            }
            
            if (!yearsExperience || yearsExperience < 0) {
                alert('Veuillez saisir un nombre valide d\'années d\'expérience.');
                return;
            }
            
            userEducationLevel = educationLevel;
            userExperienceYears = parseFloat(yearsExperience);
            
            document.getElementById('cvInfoForm').classList.add('hidden');
            document.getElementById('cv-analysis-content').classList.remove('hidden');
        }

        function extractTextFromPDF(file) {
            return new Promise((resolve, reject) => {
                const fileReader = new FileReader();
                
                fileReader.onload = function() {
                    const typedarray = new Uint8Array(this.result);
                    
                    pdfjsLib.getDocument(typedarray).promise.then(pdf => {
                        let text = '';
                        const numPages = pdf.numPages;
                        
                        const extractPage = (pageNum) => {
                            return pdf.getPage(pageNum).then(page => {
                                return page.getTextContent();
                            }).then(textContent => {
                                let lastY, line = '';
                                let pageText = [];
                                
                                textContent.items.sort((a, b) => {
                                    return b.transform[5] - a.transform[5];
                                });
                                
                                for (let item of textContent.items) {
                                    if (lastY === undefined) {
                                        lastY = item.transform[5];
                                        line = item.str;
                                    } else if (lastY !== item.transform[5]) {
                                        pageText.push(line);
                                        line = item.str;
                                        lastY = item.transform[5];
                                    } else {
                                        line += ' ' + item.str;
                                    }
                                }
                                pageText.push(line);
                                
                                text += pageText.join('\n') + '\n\n';
                                
                                if (pageNum < numPages) {
                                    return extractPage(pageNum + 1);
                                } else {
                                    return text;
                                }
                            }).catch(error => {
                                reject(error);
                            });
                        };
                        
                        extractPage(1).then(resolve).catch(reject);
                    }).catch(reject);
                };
                
                fileReader.readAsArrayBuffer(file);
            });
        }

        function filterJobs() {
            if (!jobsLoaded) {
                alert('Les offres d'emploi sont en cours de chargement. Veuillez patienter.');
                return;
            }
            
            document.querySelector('.loading').style.display = 'block';
            document.getElementById('jobs').innerHTML = '';
            
            setTimeout(() => {
                const searchTerm = document.getElementById('q').value.trim().toLowerCase();
                const locationTerm = document.getElementById('location').value.trim().toLowerCase();
                const contractFilter = document.getElementById('contract').value;
                const sectorFilter = document.getElementById('sector').value;
                const dateFilter = document.getElementById('datePosted').value;
                
                activeFilters = {
                    search: searchTerm,
                    location: locationTerm,
                    contract: contractFilter,
                    sector: sectorFilter,
                    date: dateFilter
                };
                
                filteredJobs = JOBS.filter(job => {
                    if (searchTerm && !(
                        job.title.toLowerCase().includes(searchTerm) || 
                        job.company.toLowerCase().includes(searchTerm) ||
                        (job.description && job.description.toLowerCase().includes(searchTerm)) ||
                        (job.requirements && job.requirements.toLowerCase().includes(searchTerm))
                    )) {
                        return false;
                    }
                    
                    if (locationTerm && job.location && !job.location.toLowerCase().includes(locationTerm)) {
                        return false;
                    }
                    
                    if (contractFilter && job.type !== contractFilter) {
                        return false;
                    }
                    
                    if (sectorFilter && job.sector !== sectorFilter) {
                        return false;
                    }
                    
                    if (dateFilter) {
                        const jobDate = new Date(job.date);
                        if (isNaN(jobDate.getTime())) return false;
                        
                        const daysDiff = Math.floor((new Date() - jobDate) / (1000 * 60 * 60 * 24));
                        if (daysDiff > parseInt(dateFilter)) {
                            return false;
                        }
                    }
                    
                    return true;
                });
                
                currentPage = 1;
                renderJobs(filteredJobs);
                updatePagination();
                updateFilterIndicator();
                document.querySelector('.loading').style.display = 'none';
            }, 500);
        }

        function clearFilters() {
            document.getElementById('q').value = '';
            document.getElementById('location').value = '';
            document.getElementById('contract').value = '';
            document.getElementById('sector').value = '';
            document.getElementById('datePosted').value = '';
            
            activeFilters = {};
            filteredJobs = [...JOBS];
            currentPage = 1;
            
            renderJobs(filteredJobs);
            updatePagination();
            updateFilterIndicator();
        }

        function updateFilterIndicator() {
            const indicator = document.getElementById('filterIndicator');
            const activeFiltersCount = Object.values(activeFilters).filter(val => val !== '').length;
            
            if (activeFiltersCount > 0) {
                indicator.classList.remove('hidden');
                indicator.textContent = `${activeFiltersCount} filtre(s) actif(s)`;
            } else {
                indicator.classList.add('hidden');
            }
        }

        function renderJobs(jobs) {
            const container = document.getElementById('jobs');
            container.innerHTML = '';
            
            const startIndex = (currentPage - 1) * jobsPerPage;
            const endIndex = startIndex + jobsPerPage;
            const jobsToRender = jobs.slice(startIndex, endIndex);
            
            document.getElementById('count').textContent = jobs.length;
            
            if (jobsToRender.length === 0) {
                container.innerHTML = `
                    <div class="bg-white rounded-xl p-8 text-center shadow-sm border border-gray-100">
                        <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
                        <h3 class="text-lg font-semibold text-gray-700">Aucune offre trouvée</h3>
                        <p class="text-gray-500 mt-2">Essayez de modifier vos critères de recherche ou <a href="#" id="clearSearch" class="text-green-600 hover:underline">réinitialiser les filtres</a>.</p>
                    </div>
                `;
                
                document.getElementById('clearSearch').addEventListener('click', function(e) {
                    e.preventDefault();
                    clearFilters();
                });
                
                return;
            }
            
            jobsToRender.forEach(job => {
                const card = document.createElement('article');
                card.className = 'card bg-white rounded-xl p-5 shadow-sm border border-gray-100 relative';
                card.setAttribute('data-job-id', job.id);
                
                const jobViews = getJobViews(job.id);
                const savedScores = JSON.parse(localStorage.getItem('cvScores') || '{}');
                const jobScore = savedScores[job.id];
                
                let formattedDate = 'Date non spécifiée';
                let formattedExpirationDate = 'Date non spécifiée';
                
                try {
                    if (job.date) {
                        formattedDate = new Date(job.date).toLocaleDateString('fr-FR', {
                            day: 'numeric',
                            month: 'long',
                            year: 'numeric'
                        });
                    }
                    
                    if (job.expirationDate) {
                        formattedExpirationDate = new Date(job.expirationDate).toLocaleDateString('fr-FR', {
                            day: 'numeric',
                            month: 'long',
                            year: 'numeric'
                        });
                    }
                } catch (e) {
                    console.error('Erreur de formatage de date:', e);
                }
                
                card.innerHTML = `
                    ${jobScore ? `<div class="job-match-badge"><i class="fas fa-chart-line mr-1"></i> ${jobScore}%</div>` : ''}
                    <div class="flex flex-col md:flex-row gap-5">
                        <div class="flex-1">
                            <h4 class="text-lg font-semibold text-gray-800">${job.title || 'Titre non spécifié'}</h4>
                            <div class="flex items-center mt-2 text-gray-600">
                                <i class="fas fa-building mr-2 text-sm"></i>
                                <span class="text-sm">${job.company || 'Entreprise non spécifiée'}</span>
                            </div>
                            
                            <div class="flex flex-wrap mt-4 gap-2">
                                <span class="tag tag-location">
                                    <i class="fas fa-map-marker-alt mr-1"></i> ${job.location || 'Lieu non spécifié'}
                                </span>
                                <span class="tag tag-contract">${job.type || 'Type non spécifié'}</span>
                                <span class="tag tag-sector">${job.sector || 'Secteur non spécifié'}</span>
                                <span class="tag tag-date">
                                    <i class="far fa-calendar-alt mr-1"></i> Publié: ${formattedDate}
                                </span>
                                <span class="tag tag-date">
                                    <i class="fas fa-hourglass-end mr-1"></i> Expire: ${formattedExpirationDate}
                                </span>
                                <span class="tag tag-views job-views">
                                    <i class="fas fa-eye mr-1"></i> ${jobViews} vue${jobViews > 1 ? 's' : ''}
                                </span>
                            </div>
                        </div>
                        
                        <div class="md:w-1/3 flex flex-col justify-between">
                            <div class="mt-4 flex flex-col sm:flex-row gap-2">
                                <button class="view-btn px-4 py-2 border border-green-600 text-green-600 rounded-lg text-sm font-medium hover:bg-green-50 transition-colors flex items-center justify-center">
                                    <i class="fas fa-eye mr-2"></i> Voir détails
                                </button>
                                <button class="analyze-cv-btn px-4 py-2 border border-green-600 text-green-600 rounded-lg text-sm font-medium hover:bg-green-50 transition-colors flex items-center justify-center" data-job-id="${job.id}">
                                    <i class="fas fa-chart-line mr-2"></i> Analyser CV
                                </button>
                                <a href="https://wa.me/22790143507?text=Je%20suis%20intéressé%20par%20l'offre%20${encodeURIComponent(job.title || '')}%20de%20${encodeURIComponent(job.company || '')}" 
                                   class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium text-center flex items-center justify-center">
                                    <i class="fab fa-whatsapp mr-2"></i> WhatsApp
                                </a>
                                <a href="mailto:abdoulazizeaboubacare@yahoo.fr?subject=Candidature%20pour%20le%20poste%20${encodeURIComponent(job.title || '')}&body=Je%20souhaite%20postuler%20pour%20le%20poste%20de%20${encodeURIComponent(job.title || '')}%20chez%20${encodeURIComponent(job.company || '')}" 
                                   class="px-4 py-2 bg-orange-500 text-white rounded-lg text-sm font-medium text-center flex items-center justify-center">
                                    <i class="fas fa-envelope mr-2"></i> Email
                                </a>
                            </div>
                        </div>
                    </div>
                `;
                
                const viewBtn = card.querySelector('.view-btn');
                viewBtn.addEventListener('click', () => showJobDetails(job));
                
                const analyzeBtn = card.querySelector('.analyze-cv-btn');
                analyzeBtn.addEventListener('click', function() {
                    currentJobIdForAnalysis = this.getAttribute('data-job-id');
                    const jobData = JOBS.find(j => j.id == currentJobIdForAnalysis);
                    if (jobData) {
                        document.getElementById('job-desc').value = (jobData.description || '') + "\n\nCompétences requises: " + (jobData.requirements || '');
                        
                        document.getElementById('cvInfoForm').classList.remove('hidden');
                        document.getElementById('cv-analysis-content').classList.add('hidden');
                        document.getElementById('analyzer-result').classList.add('hidden');
                        
                        document.getElementById('analyse-cv').scrollIntoView({ behavior: 'smooth' });
                    }
                });
                
                container.appendChild(card);
            });
        }

        function showJobDetails(job) {
            const updatedViews = incrementJobViews(job.id);
            
            let formattedDate = 'Date non spécifiée';
            let formattedExpirationDate = 'Date non spécifiée';
            
            try {
                if (job.date) {
                    formattedDate = new Date(job.date).toLocaleDateString('fr-FR', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    });
                }
                
                if (job.expirationDate) {
                    formattedExpirationDate = new Date(job.expirationDate).toLocaleDateString('fr-FR', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    });
                }
            } catch (e) {
                console.error('Erreur de formatage de date:', e);
            }
            
            const savedScores = JSON.parse(localStorage.getItem('cvScores') || '{}');
            const jobScore = savedScores[job.id];
            
            const modalContent = `
                <div class="modal-content" style="max-height: 85vh; overflow-y: auto;">
                    <span class="close">&times;</span>
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">${job.title || 'Titre non spécifié'}</h2>
                        <div class="flex items-center mt-2 text-gray-600">
                            <i class="fas fa-building mr-2"></i>
                            <span>${job.company || 'Entreprise non spécifiée'}</span>
                        </div>
                        ${jobScore ? `<div class="mt-2 inline-block bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm"><i class="fas fa-chart-line mr-1"></i> Votre score de correspondance: ${jobScore}%</div>` : ''}
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-500">Lieu</div>
                            <div class="font-medium"><i class="fas fa-map-marker-alt mr-2 text-green-600"></i> ${job.location || 'Non spécifié'}</div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-500">Type de contrat</div>
                            <div class="font-medium"><i class="fas fa-file-contract mr-2 text-green-600"></i> ${job.type || 'Non spécifié'}</div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-500">Secteur</div>
                            <div class="font-medium"><i class="fas fa-industry mr-2 text-green-600"></i> ${job.sector || 'Non spécifié'}</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-500">Date de publication</div>
                            <div class="font-medium"><i class="far fa-calendar-alt mr-2 text-green-600"></i> ${formattedDate}</div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-500">Date d'expiration</div>
                            <div class="font-medium"><i class="fas fa-hourglass-end mr-2 text-green-600"></i> ${formattedExpirationDate}</div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg mb-6">
                        <div class="text-sm text-gray-500">Nombre de vues</div>
                        <div class="font-medium modal-job-views"><i class="fas fa-eye mr-2 text-green-600"></i> ${updatedViews} vue${updatedViews > 1 ? 's' : ''}</div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3">Description du poste</h3>
                        <p class="text-gray-700">${job.description || 'Aucune description disponible.'}</p>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3">Profil recherché</h3>
                        <ul class="list-disc pl-5 text-gray-700 space-y-2">
                            <li>Niveau d'éducation: ${job.education || 'Non spécifié'}</li>
                            <li>Expérience: ${job.experience || 'Non spécifié'}</li>
                            <li>Compétences: ${Array.isArray(job.skills) ? job.skills.join(', ') : (job.skills || 'Non spécifiées')}</li>
                        </ul>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t border-gray-200">
                        <button class="px-6 py-3 border border-green-600 text-green-600 rounded-lg font-medium hover:bg-green-50 transition-colors flex items-center justify-center" id="analyzeFromModal" data-job-id="${job.id}">
                            <i class="fas fa-chart-line mr-2 text-lg"></i> Analyser mon CV
                        </button>
                        <a href="https://wa.me/22790143507?text=Je%20suis%20intéressé%20par%20l'offre%20${encodeURIComponent(job.title || '')}%20de%20${encodeURIComponent(job.company || '')}" 
                           class="px-6 py-3 bg-green-600 text-white rounded-lg font-medium text-center flex items-center justify-center">
                            <i class="fab fa-whatsapp mr-2 text-lg"></i> Postuler via WhatsApp
                        </a>
                        <a href="mailto:abdoulazizeaboubacare@yahoo.fr?subject=Candidature%20pour%20le%20poste%20${encodeURIComponent(job.title || '')}&body=Je%20souhaite%20postuler%20pour%20le%20poste%20de%20${encodeURIComponent(job.title || '')}%20chez%20${encodeURIComponent(job.company || '')}" 
                           class="px-6 py-3 bg-orange-500 text-white rounded-lg font-medium text-center flex items-center justify-center">
                            <i class="fas fa-envelope mr-2 text-lg"></i> Postuler par email
                        </a>
                        <button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors" id="closeDetails">
                            Fermer
                        </button>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = modalContent;
            document.body.appendChild(modal);
            modal.style.display = 'block';
            
            updateJobViewsDisplay(job.id, updatedViews);
            
            const closeBtn = modal.querySelector('.close');
            closeBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
                renderJobs(filteredJobs);
            });
            
            const closeDetailsBtn = modal.querySelector('#closeDetails');
            closeDetailsBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
                renderJobs(filteredJobs);
            });
            
            const analyzeFromModalBtn = modal.querySelector('#analyzeFromModal');
            analyzeFromModalBtn.addEventListener('click', function() {
                currentJobIdForAnalysis = this.getAttribute('data-job-id');
                const jobData = JOBS.find(j => j.id == currentJobIdForAnalysis);
                if (jobData) {
                    document.getElementById('job-desc').value = (jobData.description || '') + "\n\nCompétences requises: " + (jobData.requirements || '');
                    
                    document.getElementById('cvInfoForm').classList.remove('hidden');
                    document.getElementById('cv-analysis-content').classList.add('hidden');
                    document.getElementById('analyzer-result').classList.add('hidden');
                    
                    document.body.removeChild(modal);
                    document.getElementById('analyse-cv').scrollIntoView({ behavior: 'smooth' });
                }
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                    renderJobs(filteredJobs);
                }
            });
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredJobs.length / jobsPerPage);
            document.getElementById('paginationInfo').textContent = `Page ${currentPage} sur ${totalPages}`;
            
            document.getElementById('prev').disabled = currentPage === 1;
            document.getElementById('next').disabled = currentPage === totalPages || totalPages === 0;
        }

        // ==============================================
        // ALGORITHME D'ANALYSE DE CV (CONSERVÉ)
        // ==============================================

        function analyzeCV() {
            let cvText = document.getElementById('cv-text').value;
            const jobText = document.getElementById('job-desc').value;
            
            if (!cvText || !jobText) {
                alert('Veuillez remplir les deux champs pour analyser votre CV.');
                return;
            }
            
            document.getElementById('analyzer-result').classList.add('hidden');
            document.getElementById('analyze-btn').disabled = true;
            document.getElementById('analyze-btn').textContent = 'Analyse en cours...';
            
            setTimeout(() => {
                const analysis = newCVAnalysis(cvText, jobText);
                currentAnalysisResult = analysis;
                
                displayAnalysisResults(analysis);
                
                document.getElementById('analyze-btn').disabled = false;
                document.getElementById('analyze-btn').textContent = 'Analyser la correspondance';
            }, 1500);
        }

        function newCVAnalysis(cvText, jobText) {
            const cleanCV = preprocessText(cvText);
            const cleanJob = preprocessText(jobText);
            
            const educationExperienceScore = calculateEducationExperienceScore(jobText);
            const keywordScore = calculateKeywordScore(cvText, jobText);
            const textSimilarityScore = calculateTextSimilarity(cleanCV, cleanJob);
            
            const finalScore = Math.round(
                (educationExperienceScore * 0.4) + 
                (keywordScore * 0.4) + 
                (textSimilarityScore * 0.2)
            );
            
            const { matchedKeywords, missingKeywords } = extractKeywordMatches(cvText, jobText);
            
            return {
                score: finalScore,
                matchedKeywords: matchedKeywords,
                missingKeywords: missingKeywords,
                educationExperienceScore: Math.round(educationExperienceScore),
                keywordScore: Math.round(keywordScore),
                textSimilarityScore: Math.round(textSimilarityScore),
                suggestions: generateImprovementSuggestions(matchedKeywords, missingKeywords, educationExperienceScore, keywordScore)
            };
        }

        function calculateEducationExperienceScore(jobText) {
            let score = 0;
            let maxScore = 100;
            
            const jobEducation = extractEducationLevelFromJob(jobText);
            const educationMatch = checkEducationMatch(userEducationLevel, jobEducation);
            score += educationMatch * 20;
            
            const jobExperience = extractExperienceFromJob(jobText);
            const experienceMatch = checkExperienceMatch(userExperienceYears, jobExperience);
            score += experienceMatch * 20;
            
            return Math.min(score, maxScore);
        }

        function checkEducationMatch(userEducation, jobEducation) {
            const educationLevels = {
                "Niveau non spécifié": 0,
                "CFEPD": 1,
                "BEPC": 2,
                "BAC": 3,
                "BTS": 4,
                "LICENCE": 5,
                "MASTER": 6,
                "DOCTORAT": 7,
                "AUTRE": 0
            };
            
            if (jobEducation === "Niveau non spécifié") {
                return 1;
            }
            
            const userLevel = educationLevels[userEducation] || 0;
            const jobLevel = educationLevels[jobEducation] || 0;
            
            if (userLevel >= jobLevel) {
                return 1;
            } else {
                return userLevel / Math.max(jobLevel, 1);
            }
        }

        function checkExperienceMatch(userExperience, jobExperience) {
            if (jobExperience === 0) {
                return 1;
            }
            
            if (userExperience >= jobExperience) {
                return 1;
            } else {
                return userExperience / Math.max(jobExperience, 1);
            }
        }

        function calculateKeywordScore(cvText, jobText) {
            const jobKeywords = extractImportantKeywords(jobText);
            
            if (jobKeywords.length === 0) {
                return 100;
            }
            
            let matchCount = 0;
            const cleanCV = cvText.toLowerCase();
            
            jobKeywords.forEach(keyword => {
                if (cleanCV.includes(keyword.toLowerCase())) {
                    matchCount++;
                }
            });
            
            return (matchCount / jobKeywords.length) * 100;
        }

        function extractImportantKeywords(text) {
            const stopwords = ['le', 'la', 'les', 'de', 'des', 'du', 'et', 'est', 'en', 'un', 'une', 'au', 'aux', 
                              'dans', 'par', 'pour', 'sur', 'avec', 'son', 'ses', 'qui', 'que', 'quoi', 'quand', 
                              'ou', 'comment', 'pourquoi', 'ce', 'cet', 'cette', 'ces', 'a', 'ans', 'annees', 
                              'annee', 'ans', 'an', 'dans', 'par', 'pour', 'sur', 'avec', 'son', 'ses', 'qui', 
                              'que', 'quoi', 'quand', 'ou', 'comment', 'pourquoi', 'ce', 'cet', 'cette', 'ces', 
                              'a', 'ans', 'annees', 'annee', 'ans', 'an', 'être', 'avoir', 'faire', 'dire', 'voir'];
            
            let cleanText = text.toLowerCase()
                .replace(/[^\w\s]/g, ' ')
                .replace(/\s+/g, ' ')
                .trim();
            
            const words = cleanText.split(' ');
            
            const significantWords = words.filter(word => 
                word.length > 3 && 
                !stopwords.includes(word) &&
                !/\d/.test(word)
            );
            
            const wordFreq = {};
            significantWords.forEach(word => {
                wordFreq[word] = (wordFreq[word] || 0) + 1;
            });
            
            return Object.keys(wordFreq)
                .sort((a, b) => wordFreq[b] - wordFreq[a])
                .slice(0, 15);
        }

        function calculateTextSimilarity(text1, text2) {
            if (!text1 || !text2) return 0;
            
            const words1 = text1.split(' ');
            const words2 = text2.split(' ');
            const allWords = [...new Set([...words1, ...words2])];
            
            const vector1 = allWords.map(word => words1.filter(w => w === word).length);
            const vector2 = allWords.map(word => words2.filter(w => w === word).length);
            
            let dotProduct = 0;
            for (let i = 0; i < allWords.length; i++) {
                dotProduct += vector1[i] * vector2[i];
            }
            
            const magnitude1 = Math.sqrt(vector1.reduce((sum, val) => sum + val * val, 0));
            const magnitude2 = Math.sqrt(vector2.reduce((sum, val) => sum + val * val, 0));
            
            if (magnitude1 === 0 || magnitude2 === 0) {
                return 0;
            }
            
            return (dotProduct / (magnitude1 * magnitude2)) * 100;
        }

        function extractKeywordMatches(cvText, jobText) {
            const jobKeywords = extractImportantKeywords(jobText);
            const cvTextLower = cvText.toLowerCase();
            
            const matchedKeywords = [];
            const missingKeywords = [];
            
            jobKeywords.forEach(keyword => {
                if (cvTextLower.includes(keyword.toLowerCase())) {
                    matchedKeywords.push(keyword);
                } else {
                    missingKeywords.push(keyword);
                }
            });
            
            return { matchedKeywords, missingKeywords };
        }

        function generateImprovementSuggestions(matched, missing, educationScore, keywordScore) {
            const suggestions = [];
            
            if (educationScore < 80) {
                suggestions.push("Votre niveau d'éducation ou votre expérience ne correspondent pas parfaitement aux exigences du poste. Mettez en avant vos compétences transférables.");
            }
            
            if (keywordScore < 70) {
                suggestions.push(`Améliorez votre CV en ajoutant les mots-clés suivants: ${missing.slice(0, 5).join(', ')}.`);
            }
            
            if (matched.length > 0) {
                suggestions.push("Votre CV contient déjà certains mots-clés importants. C'est un bon point de départ!");
            }
            
            if (missing.length > 5) {
                suggestions.push("Votre CV manque de plusieurs mots-clés importants. Essayez de reformuler vos expériences pour inclure ces termes.");
            }
            
            suggestions.push("Utilisez des verbes d'action pour décrire vos réalisations (ex: développé, géré, optimisé, etc.).");
            suggestions.push("Ajoutez des chiffres et résultats concrets pour quantifier vos réussites.");
            
            return suggestions;
        }

        function extractEducationLevelFromJob(jobText) {
            const educationPatterns = [
                { pattern: /doctorat|phd|d\.?phil|thèse/i, level: "DOCTORAT" },
                { pattern: /master|mastère|mba|bac\s*\+?\s*5/i, level: "MASTER" },
                { pattern: /licence|bachelor|bac\s*\+?\s*[34]/i, level: "LICENCE" },
                { pattern: /bts|dut|deug|bac\s*\+?\s*2/i, level: "BTS" },
                { pattern: /baccalaureat|bac|bachelier|bac\s*\+?\s*0/i, level: "BAC" },
                { pattern: /brevet|bep|cap|befp/i, level: "BEPC" }
            ];
            
            for (const edu of educationPatterns) {
                if (edu.pattern.test(jobText)) {
                    return edu.level;
                }
            }
            
            return "Niveau non spécifié";
        }

        function extractExperienceFromJob(jobText) {
            const experiencePatterns = [
                /(\d+)\s*(ans|années|année|an)(?:\s*.*?)(?:d'|d\s)?expérience/gi,
                /expérience.*?(\d+)\s*(ans|années|année|an)/gi,
                /(\d+)\s*-\s*(\d+)\s*(ans|années|année|an).*?expérience/gi,
                /(\d+)\s*\/\s*(\d+)\s*(ans|années|année|an).*?expérience/gi
            ];
            
            let maxExperience = 0;
            
            experiencePatterns.forEach(pattern => {
                const matches = jobText.match(pattern);
                if (matches) {
                    matches.forEach(match => {
                        const numbers = match.match(/\d+/g);
                        if (numbers) {
                            const maxInMatch = Math.max(...numbers.map(n => parseInt(n)));
                            if (maxInMatch > maxExperience) {
                                maxExperience = maxInMatch;
                            }
                        }
                    });
                }
            });
            
            return maxExperience;
        }

        function preprocessText(text) {
            text = text.toLowerCase();
            text = text.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            text = text.replace(/[^\w\s]/g, ' ');
            text = text.replace(/\s+/g, ' ').trim();
            return text;
        }

        function displayAnalysisResults(analysis) {
            document.querySelector('.circle-value').textContent = `${analysis.score}%`;
            document.querySelector('.circle').style.strokeDasharray = `${analysis.score}, 100`;
            
            const matchedContainer = document.getElementById('matched-keywords');
            matchedContainer.innerHTML = '';
            if (analysis.matchedKeywords.length > 0) {
                analysis.matchedKeywords.slice(0, 10).forEach(keyword => {
                    const span = document.createElement('span');
                    span.className = 'keyword-match';
                    span.textContent = keyword;
                    matchedContainer.appendChild(span);
                });
            } else {
                matchedContainer.innerHTML = '<p>Aucun mot-clé correspondant trouvé.</p>';
            }
            
            const missingContainer = document.getElementById('missing-keywords');
            missingContainer.innerHTML = '';
            if (analysis.missingKeywords.length > 0) {
                analysis.missingKeywords.slice(0, 10).forEach(keyword => {
                    const span = document.createElement('span');
                    span.className = 'missing-keyword';
                    span.textContent = keyword;
                    missingContainer.appendChild(span);
                });
            } else {
                missingContainer.innerHTML = '<p>Tous les mots-clés importants sont présents dans votre CV.</p>';
            }
            
            const detailedContainer = document.getElementById('detailed-analysis');
            detailedContainer.innerHTML = `
                <p>🎓 Score Éducation/Expérience: <strong>${analysis.educationExperienceScore}%</strong></p>
                <p>🔑 Score Mots-clés: <strong>${analysis.keywordScore}%</strong></p>
                <p>📝 Score Similarité textuelle: <strong>${analysis.textSimilarityScore}%</strong></p>
                <p>✅ Mots-clés correspondants: <strong>${analysis.matchedKeywords.length}</strong> sur ${analysis.matchedKeywords.length + analysis.missingKeywords.length}</p>
            `;
            
            const tipsContainer = document.getElementById('improvement-tips');
            tipsContainer.innerHTML = '';
            analysis.suggestions.forEach(tip => {
                const li = document.createElement('li');
                li.textContent = tip;
                tipsContainer.appendChild(li);
            });
            
            document.getElementById('analyzer-result').classList.remove('hidden');
            document.getElementById('analyzer-result').scrollIntoView({ behavior: 'smooth' });
        }

        function saveAnalysisResult() {
            if (!currentAnalysisResult || !currentJobIdForAnalysis) {
                alert("Veuillez d'abord analyser votre CV pour une offre d'emploi spécifique.");
                return;
            }
            
            const savedScores = JSON.parse(localStorage.getItem('cvScores') || '{}');
            savedScores[currentJobIdForAnalysis] = currentAnalysisResult.score;
            localStorage.setItem('cvScores', JSON.stringify(savedScores));
            
            const savedResults = JSON.parse(localStorage.getItem('cvAnalysisResults') || '{}');
            const jobKey = `job_${currentJobIdForAnalysis}_${Date.now()}`;
            savedResults[jobKey] = {
                jobId: currentJobIdForAnalysis,
                score: currentAnalysisResult.score,
                date: new Date().toISOString(),
                matchedKeywords: currentAnalysisResult.matchedKeywords,
                missingKeywords: currentAnalysisResult.missingKeywords
            };
            localStorage.setItem('cvAnalysisResults', JSON.stringify(savedResults));
            
            renderJobs(filteredJobs);
            
            alert(`Résultat enregistré avec succès! Votre score de correspondance est de ${currentAnalysisResult.score}%.`);
        }
    </script>
</body>
</html>