<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Insert - Offres d'emploi au Niger</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        secondary: {
                            50: '#faf6f0',
                            100: '#f5ebdc',
                            200: '#edd8bb',
                            300: '#e2bd90',
                            400: '#d69a5e',
                            500: '#c17a3a',
                            600: '#a3622f',
                            700: '#834d29',
                            800: '#6a3e25',
                            900: '#563422',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: #f8fafc;
            scroll-behavior: smooth;
        }
        
        .card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border-left: 4px solid transparent;
        }
        
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-left-color: #0ea5e9;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 24px;
            border: none;
            width: 90%;
            max-width: 700px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s ease;
            position: relative;
            max-height: 85vh;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
            position: absolute;
            top: 15px;
            right: 20px;
            z-index: 10;
        }
        
        .close:hover {
            color: #333;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(2, 132, 199, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #c17a3a 0%, #a3622f 100%);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #a3622f 0%, #834d29 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(163, 98, 47, 0.3);
        }
        
        .search-input {
            transition: all 0.3s ease;
            border: 2px solid #e2e8f0;
        }
        
        .search-input:focus {
            border-color: #7dd3fc;
            box-shadow: 0 0 0 3px rgba(125, 211, 252, 0.3);
        }
        
        .filter-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            margin-top: 16px;
            color: #475569;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0ea5e9;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        .company-logo {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f1f5f9;
            border-radius: 8px;
            font-weight: bold;
            color: #0ea5e9;
            margin: 0 auto 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .pagination-btn {
            transition: all 0.2s ease;
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination-btn:not(:disabled):hover {
            background-color: #e0f2fe;
        }
        
        .tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 500;
            margin-right: 6px;
            margin-bottom: 6px;
        }
        
        .tag-contract {
            background-color: #e0f2fe;
            color: #0369a1;
        }
        
        .tag-sector {
            background-color: #f0fdf4;
            color: #166534;
        }
        
        .tag-location {
            background-color: #fef7ed;
            color: #9a3412;
        }
        
        .tag-date {
            background-color: #fae8ff;
            color: #a21caf;
        }
        
        .salary {
            font-weight: 600;
            color: #166534;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Styles pour l'analyseur de CV */
        .cv-analyzer {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-top: 2rem;
        }
        
        .analyzer-result {
            margin-top: 1rem;
            font-weight: bold;
            padding: 1rem;
            border-radius: 8px;
            backgroundColor: #f8fafc;
        }
        
        .progress-bar {
            height: 10px;
            border-radius: 5px;
            background-color: #e5e7eb;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 5px;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            transition: width 0.5s ease;
        }
        
        .keyword-match {
            display: inline;
            background-color: #d1fae5;
            color: #065f46;
            padding: 2px 8px;
            border-radius: 4px;
            margin: 4px 4px 4px 0;
            font-size: 0.875rem;
            white-space: normal;
            word-break: normal;
            overflow-wrap: break-word;
            hyphens: auto;
        }
        
        .missing-keyword {
            display: inline;
            background-color: #fee2e2;
            color: #b91c1c;
            padding: 2px 8px;
            border-radius: 4px;
            margin: 4px 4px 4px 0;
            font-size: 0.875rem;
            white-space: normal;
            word-break: normal;
            overflow-wrap: break-word;
            hyphens: auto;
        }
        
        .score-circle {
            width: 100px;
            height: 100px;
            position: relative;
            margin: 0 auto;
        }
        
        .circle-bg {
            fill: none;
            stroke: #e5e7eb;
            stroke-width: 3.8;
        }
        
        .circle {
            fill: none;
            stroke-width: 3.8;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 0.8s ease;
        }
        
        .circle-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .pdf-upload-container {
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pdf-upload-container:hover {
            border-color: #0ea5e9;
            background-color: #f0f9ff;
        }
        
        .pdf-upload-icon {
            font-size: 3rem;
            color: #0ea5e9;
            margin-bottom: 10px;
        }
        
        .pdf-preview {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background-color: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .pdf-preview p {
            margin: 5px 0;
        }
        
        .pdf-extracted-text {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e2e8f0;
            margin-top: 10px;
            font-size: 0.875rem;
            white-space: pre-wrap;
            word-break: break-word;
            overflow-wrap: break-word;
        }
        
        .job-match-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #10b981;
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .cv-info-form {
            background-color: #f0f9ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #0ea5e9;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #374151;
        }
        
        .form-select, .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .form-select:focus, .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        .required-field::after {
            content: '*';
            color: #ef4444;
            margin-left: 3px;
        }
        
        @media (max-width: 768px) {
            .hero-content {
                flex-direction: column;
            }
            
            .search-input, .search-btn {
                width: 100%;
            }
            
            .cv-analyzer {
                padding: 1rem;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }
        }
    </style>
</head>
<body class="font-sans bg-gray-50">
    <header class="bg-white shadow-sm sticky top-0 z-40">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center">
                <div class="text-2xl font-bold text-primary-600 flex items-center">
                    <i class="fas fa-briefcase mr-2"></i> Smart Insert
                </div>
                <div class="ml-2 text-sm text-gray-600 hidden md:block">Votre carrière commence ici</div>
            </div>
            
            <nav class="hidden md:flex items-center gap-6">
                <a class="text-sm font-medium hover:text-primary-600 transition-colors" href="#offres">Offres</a>
                <a class="text-sm font-medium hover:text-primary-600 transition-colors" href="#entreprises">Entreprises</a>
                <a class="text-sm font-medium hover:text-primary-600 transition-colors" href="#conseils">Conseils</a>
                <a class="text-sm font-medium hover:text-primary-600 transition-colors" href="#analyse-cv">Analyse CV</a>
                <a href="https://wa.me/22790143507?text=Je%20suis%20intéressé%20par%20vos%20services" class="ml-2 px-4 py-2 btn-primary text-white rounded-lg text-sm font-medium flex items-center">
                    <i class="fab fa-whatsapp mr-2"></i> Contact
                </a>
                <div data-netlify-identity-menu></div>
            </nav>
            
            <button class="md:hidden text-gray-600" id="mobileMenuBtn">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>
        
        <!-- Menu mobile -->
        <div class="md:hidden bg-white shadow-md hidden" id="mobileMenu">
            <div class="container mx-auto px-4 py-3 flex flex-col space-y-3">
                <a class="text-sm font-medium hover:text-primary-600 py-2" href="#offres">Offres d'emploi</a>
                <a class="text-sm font-medium hover:text-primary-600 py-2" href="#entreprises">Entreprises</a>
                <a class="text-sm font-medium hover:text-primary-600 py-2" href="#conseils">Conseils CV</a>
                <a class="text-sm font-medium hover:text-primary-600 py-2" href="#analyse-cv">Analyse CV</a>
                <a href="https://wa.me/22790143507?text=Je%20suis%20intéressé%20par%20vos%20services" class="px-4 py-2 btn-primary text-white rounded-lg text-sm font-medium text-center">
                    Contact WhatsApp
                </a>
                <div data-netlify-identity-menu></div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- Section Hero -->
        <section class="bg-gradient-to-r from-primary-600 to-primary-800 text-white rounded-2xl p-8 mb-8 shadow-lg">
            <div class="max-w-4xl mx-auto">
                <h1 class="text-3xl md:text-4xl font-bold mb-4">Trouvez l'emploi idéal au Niger</h1>
                <p class="mb-6 text-lg opacity-90">Des centaines d'offres d'emploi dans tous les secteurs. Filtrez par mot-clé, lieu ou entreprise.</p>
                
                <div class="bg-white p-2 rounded-lg shadow-inner">
                    <form id="searchForm" class="flex flex-col md:flex-row gap-2">
                        <div class="flex-1 flex flex-col md:flex-row gap-2">
                            <div class="relative flex-1">
                                <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                                <input id="q" type="search" placeholder="Métier, compétence ou entreprise" class="pl-10 pr-4 py-3 rounded-lg border-0 search-input text-gray-800 w-full" />
                            </div>
                            <div class="relative flex-1">
                                <i class="fas fa-map-marker-alt absolute left-3 top-3.5 text-gray-400"></i>
                                <input id="location" type="text" placeholder="Ville ou région" class="pl-10 pr-4 py-3 rounded-lg border-0 search-input text-gray-800 w-full" />
                            </div>
                        </div>
                        <button type="submit" class="px-6 py-3 btn-primary text-white rounded-lg font-medium flex items-center justify-center">
                            <i class="fas fa-search mr-2"></i> Rechercher
                        </button>
                    </form>
                </div>
                
                <div class="mt-4 flex flex-wrap gap-2">
                    <span class="text-sm opacity-80">Suggestions :</span>
                    <button class="text-sm bg-white/20 hover:bg-white/30 px-3 py-1 rounded-full transition-colors suggestion-btn" data-suggestion="Agent de terrain">Agent de terrain</button>
                    <button class="text-sm bg-white/20 hover:bg-white/30 px-3 py-1 rounded-full transition-colors suggestion-btn" data-suggestion="Chargé de projet">Chargé de projet</button>
                    <button class="text-sm bg-white/20 hover:bg-white/30 px-3 py-1 rounded-full transition-colors suggestion-btn" data-suggestion="Niamey">Niamey</button>
                </div>
            </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Sidebar -->
            <aside class="lg:col-span-1">
                <div class="bg-white rounded-xl p-5 shadow-sm border border-gray-100">
                    <h3 class="font-semibold text-lg flex items-center">
                        <i class="fas fa-filter mr-2 text-primary-600"></i> Filtres
                    </h3>
                    
                    <div class="filter-label">
                        <i class="fas fa-file-contract text-primary-600"></i>
                        <span>Type de contrat</span>
                    </div>
                    <select id="contract" class="w-full p-3 border rounded-lg mt-1 search-input">
                        <option value="">Tous les contrats</option>
                        <option>CDD</option>
                        <option>CDI</option>
                        <option>Stage</option>
                        <option>Consultant</option>
                        <option>Freelance</option>
                    </select>
                    
                    <div class="filter-label">
                        <i class="fas fa-industry text-primary-600"></i>
                        <span>Secteur d'activité</span>
                    </div>
                    <select id="sector" class="w-full p-3 border rounded-lg mt-1 search-input">
                        <option value="">Tous les secteurs</option>
                        <option>Humanitaire</option>
                        <option>Agriculture</option>
                        <option>Éducation</option>
                        <option>Santé</option>
                        <option>Services</option>
                        <option>Commerce</option>
                        <option>Construction</option>
                        <option>Technologie</option>
                    </select>
                    
                    <div class="filter-label">
                        <i class="fas fa-calendar-alt text-primary-600"></i>
                        <span>Date de publication</span>
                    </div>
                    <select id="datePosted" class="w-full p-3 border rounded-lg mt-1 search-input">
                        <option value="">Toutes les dates</option>
                        <option value="7">Il y a moins d'une semaine</option>
                        <option value="30">Il y a moins d'un mois</option>
                        <option value="90">Il y a moins de 3 mois</option>
                    </select>
                    
                    <div class="mt-5 flex justify-between">
                        <button id="applyFilters" class="px-4 py-2 btn-primary text-white rounded-lg text-sm">
                            Appliquer
                        </button>
                        <button id="clearFilters" class="px-4 py-2 border border-gray-300 text-gray-600 rounded-lg text-sm hover:bg-gray-50">
                            Tout effacer
                        </button>
                    </div>
                </div>
                
                <div class="mt-6 bg-white rounded-xl p-5 shadow-sm border border-gray-100">
                    <h4 class="font-semibold text-lg flex items-center">
                        <i class="fas fa-building mr-2 text-primary-600"></i> Entreprises populaires
                    </h4>
                    <ul class="mt-4 space-y-3">
                        <li class="flex items-center py-2 border-b border-gray-100">
                            <div class="w-8 h-8 bg-primary-50 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-code text-primary-600"></i>
                            </div>
                            <span class="text-gray-700">Agicon</span>
                        </li>
                    </ul>
                </div>
                
                <div class="mt-6 bg-primary-50 rounded-xl p-5 border border-primary-100">
                    <h4 class="font-semibold text-lg flex items-center text-primary-700">
                        <i class="fas fa-bell mr-2"></i> Alertes emploi
                    </h4>
                    <p class="mt-2 text-sm text-primary-600">Recevez les nouvelles offres - s'inscrire</p>
                    <div class="mt-3">
                        <a href="https://wa.me/22790143507?text=Je%20souhaite%20recevoir%20des%20alertes%20emploi%20sur%20WhatsApp" class="mt-2 w-full px-4 py-2 btn-primary text-white rounded-lg text-sm block text-center">
                            S'inscrire via WhatsApp
                        </a>
                    </div>
                </div>
            </aside>

            <!-- Job list -->
            <section id="offres" class="lg:col-span-3">
                <div class="flex flex-col md:flex-row items-center justify-between mb-6">
                    <h3 class="text-xl font-semibold flex items-center">
                        <i class="fas fa-briefcase mr-2 text-primary-600"></i> Offres d'emploi
                    </h3>
                    <div class="text-sm text-gray-600 mt-2 md:mt-0">
                        <span id="count">0</span> offres trouvées
                        <span id="filterIndicator" class="hidden ml-2 bg-primary-100 text-primary-700 px-2 py-1 rounded-full text-xs"></span>
                    </div>
                </div>
                
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p class="mt-3 text-gray-600">Recherche en cours...</p>
                </div>
                
                <div id="jobs" class="grid grid-cols-1 gap-4"></div>
                
                <!-- Pagination -->
                <div class="mt-8 flex justify-center items-center space-x-4">
                    <button id="prev" class="pagination-btn px-4 py-2 rounded-lg border border-gray-300 text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center">
                        <i class="fas fa-chevron-left mr-2 text-xs"></i> Précédent
                    </button>
                    <span class="text-sm text-gray-600" id="paginationInfo">Page 1 sur 1</span>
                    <button id="next" class="pagination-btn px-4 py-2 rounded-lg border border-gray-300 text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center">
                        Suivant <i class="fas fa-chevron-right ml-2 text-xs"></i>
                    </button>
                </div>
            </section>
        </div>

        <!-- Section Analyse de CV -->
        <section id="analyse-cv" class="mt-16 py-8">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-search mr-3 text-primary-600"></i> Analysez votre CV
            </h2>
            <div class="cv-analyzer">
                <p class="text-gray-700 mb-4">Téléchargez votre CV en format PDF ou collez le texte de votre CV, ainsi que la description du poste pour obtenir une analyse détaillée de correspondance.</p>
                
                <!-- Fiche d'informations obligatoire -->
                <div class="cv-info-form" id="cvInfoForm">
                    <h3 class="text-lg font-semibold mb-4 text-primary-700">
                        <i class="fas fa-info-circle mr-2"></i> Informations requises pour l'analyse
                    </h3>
                    <p class="text-sm text-gray-600 mb-4">Ces informations nous aideront à améliorer la précision de l'analyse de votre CV.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-group">
                            <label class="form-label required-field">Niveau d'études</label>
                            <select id="education-level" class="form-select" required>
                                <option value="">Sélectionnez votre niveau</option>
                                <option value="CFEPD">CFEPD</option>
                                <option value="BEPC">BEPC</option>
                                <option value="BAC">BAC</option>
                                <option value="BTS">BTS</option>
                                <option value="LICENCE">LICENCE</option>
                                <option value="MASTER">MASTER</option>
                                <option value="DOCTORAT">DOCTORAT</option>
                                <option value="AUTRE">Autre</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required-field">Années d'expérience (en lien avec le poste)</label>
                            <input type="number" id="years-experience" class="form-input" min="0" max="50" step="0.5" placeholder="Ex: 3.5" required>
                        </div>
                    </div>
                    
                    <button id="submit-cv-info" class="mt-4 px-6 py-3 btn-primary text-white rounded-lg font-medium">
                        Valider et continuer
                    </button>
                </div>
                
                <div id="cv-analysis-content" class="hidden">
                    <div class="pdf-upload-container" id="pdfUploadContainer">
                        <div class="pdf-upload-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <p class="font-medium">Déposez votre CV PDF ici ou cliquez pour parcourir</p>
                        <p class="text-sm text-gray-500 mt-1">Supporté: PDF (max. 5MB)</p>
                        <input type="file" id="cv-pdf" accept=".pdf" class="hidden">
                    </div>
                    
                    <div id="pdf-preview" class="pdf-preview">
                        <div class="flex justify-between items-center">
                            <p class="font-medium">Fichier sélectionné: <span id="pdf-filename"></span></p>
                            <button id="remove-pdf" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="mt-2">
                            <p class="text-sm text-gray-600">Texte extrait:</p>
                            <div id="pdf-extracted-text" class="pdf-extracted-text"></div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700">Ou collez le texte de votre CV</label>
                        <textarea id="cv-text" class="w-full p-3 border rounded-lg mt-1 search-input" placeholder="Collez votre CV ici..." rows="8"></textarea>
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700">Description du poste</label>
                        <textarea id="job-desc" class="w-full p-3 border rounded-lg mt-1 search-input" placeholder="Description du poste..." rows="4"></textarea>
                    </div>
                    
                    <button id="analyze-btn" class="mt-4 px-6 py-3 btn-primary text-white rounded-lg font-medium">Analyser la correspondance</button>
                </div>
                
                <div id="analyzer-result" class="analyzer-result hidden">
                    <div class="text-center mb-6">
                        <div class="score-circle">
                            <svg viewBox="0 0 36 36" class="circular-chart">
                                <path class="circle-bg"
                                    d="M18 2.0845
                                    a 15.9155 15.9155 0 0 1 0 31.831
                                    a 15.9155 15.9155 0 0 1 0 -31.831"
                                />
                                <path class="circle" stroke="#10b981"
                                    stroke-dasharray="0, 100"
                                    d="M18 2.0845
                                    a 15.9155 15.9155 0 0 1 0 31.831
                                    a 15.9155 15.9155 0 0 1 0 -31.831"
                                />
                            </svg>
                            <div class="circle-value">0%</div>
                        </div>
                        <h3 class="text-xl font-semibold mt-2">Score de correspondance</h3>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold mb-2">📊 Mots-clés correspondants</h4>
                            <div id="matched-keywords"></div>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">⚠️ Mots-clés manquants</h4>
                            <div id="missing-keywords"></div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="font-semibold mb-2">📈 Analyse détaillée</h4>
                        <div id="detailed-analysis"></div>
                    </div>
                    
                    <div class="mt-6 bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold mb-2 text-blue-800">💡 Conseils d'amélioration</h4>
                        <ul id="improvement-tips" class="list-disc pl-5 text-blue-700"></ul>
                    </div>
                    
                    <div class="mt-6 flex justify-end">
                        <button id="save-result-btn" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium flex items-center">
                            <i class="fas fa-save mr-2"></i> Enregistrer le résultat
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section Entreprises -->
        <section id="entreprises" class="mt-16 py-8">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-building mr-3 text-primary-600"></i> Entreprises partenaires
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-white p-6 rounded-xl shadow-sm text-center border border-gray-100 hover:shadow-md transition-shadow">
                    <div class="company-logo">AG</div>
                    <h3 class="font-semibold">Agicon</h3>
                </div>
            </div>
        </section>

        <!-- Section Conseils -->
        <section id="conseils" class="mt-16 py-8">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-graduation-cap mr-3 text-primary-600"></i> Conseils pour votre recherche
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                    <div class="w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-file-alt text-primary-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">Structurez votre CV</h3>
                    <p class="text-gray-700">Un bon CV doit être clair, concis et mettre en valeur vos compétences principales. Adaptez-le à chaque offre.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                    <div class="w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-clipboard-list text-primary-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">Lettre de motivation</h3>
                    <p class="text-gray-700">Personnalisez votre lettre pour chaque emploi. Montrez votre intérêt spécifique pour l'entreprise et le poste.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                    <div class="w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-handshake text-primary-600"></i>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">Préparation entretien</h3>
                    <p class="text-gray-700">Anticipez les questions, renseignez-vous sur l'entreprise et préparez vos propres questions pour l'employeur.</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-12 mt-16">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-briefcase mr-2 text-primary-400"></i> Smart Insert
                    </h3>
                    <p class="text-sm text-gray-400">Votre plateforme d'emploi au Niger. Nous connectons les talents aux meilleures opportunités.</p>
                </div>
                
                <div>
                    <h4 class="text-md font-semibold mb-4">Navigation</h4>
                    <ul class="space-y-2">
                        <li><a href="#offres" class="text-sm text-gray-300 hover:text-white transition-colors">Offres d'emploi</a></li>
                        <li><a href="#entreprises" class="text-sm text-gray-300 hover:text-white transition-colors">Entreprises</a></li>
                        <li><a href="#conseils" class="text-sm text-gray-300 hover:text-white transition-colors">Conseils CV</a></li>
                        <li><a href="#analyse-cv" class="text-sm text-gray-300 hover:text-white transition-colors">Analyse CV</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-md font-semibold mb-4">Légal</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-sm text-gray-300 hover:text-white transition-colors" id="conditionsLink">Conditions d'utilisation</a></li>
                        <li><a href="#" class="text-sm text-gray-300 hover:text-white transition-colors" id="privacyLink">Politique de confidentialité</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-md font-semibold mb-4">Contact</h4>
                    <div class="flex items-center mb-2">
                        <i class="fab fa-whatsapp mr-2 text-gray-300"></i>
                        <a href="https://wa.me/22790143507" class="text-sm text-gray-300 hover:text-white transition-colors">+227 90 14 35 07</a>
                    </div>
                    <div class="flex items-center mb-2">
                        <i class="fas fa-envelope mr-2 text-gray-300"></i>
                        <span class="text-sm text-gray-300">abdoulazizeaboubacare@yahoo.fr</span>
                    </div>
                    <div class="flex items-center mt-4 space-x-3">
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>
            
            <div class="mt-10 pt-8 border-t border-gray-700 text-center text-sm text-gray-400">
                © <span id="year"></span> Smart Insert. Tous droits réservés.
            </div>
        </div>
    </footer>

    <!-- Modal Conditions d'utilisation -->
    <div id="conditionsModal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="conditionsModal">&times;</span>
            <h2 class="text-2xl font-bold mb-4">Conditions d'utilisation</h2>
            <div class="text-gray-700">
                <p class="mb-4">En utilisant ce site, vous accepte les conditions suivantes :</p>
                <ul class="list-disc pl-5 space-y-2">
                    <li>Le site Smart Insert est une plateforme de mise en relation entre chercheurs d'emploi et employeurs</li>
                    <li>Les offres d'emploi sont publiées sous la responsabilité des employeurs</li>
                    <li>L'utilisation des données personnelles est régie par notre politique de confidentialité</li>
                    <li>Smart Insert se réserve le droit de modifier ces conditions à tout moment</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Modal Politique de confidentialité -->
    <div id="privacyModal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="privacyModal">&times;</span>
            <h2 class="text-2xl font-bold mb-4">Politique de confidentialité</h2>
            <div class="text-gray-700">
                <p class="mb-4">Chez Smart Insert, nous prenons la protection de vos données personnelles très au sérieux :</p>
                <ul class="list-disc pl-5 space-y-2">
                    <li>Nous collectons uniquement les informations nécessaires à la mise en relation avec les employeurs</li>
                    <li>Vos données ne sont pas soldes à des tiers à des fins commerciales</li>
                    <li>Vous pouvez à tout moment demander la suppression de vos données personnelles</li>
                    <li>Nous utilisons des technologies de cryptage pour protéger vos informations</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Données des offres d'emploi (seront chargées via fetch)
        let JOBS = [];
        let jobsLoaded = false;

        // État de l'application
        let currentPage = 1;
        const jobsPerPage = 4;
        let filteredJobs = [];
        let activeFilters = {};
        let currentAnalysisResult = null;
        let currentJobIdForAnalysis = null;
        let userEducationLevel = '';
        let userExperienceYears = 0;

        // Fonction pour charger les offres d'emploi depuis le fichier JSON
        async function loadJobsFromJSON() {
            try {
                // Afficher l'indicateur de chargement
                document.querySelector('.loading').style.display = 'block';
                document.getElementById('jobs').innerHTML = '';
                
                // Récupérer les offres depuis le fichier JSON
                console.log('Chargement des offres depuis /data/content.json...');
                const jobsResponse = await fetch('/data/content.json');
                
                if (!jobsResponse.ok) {
                    throw new Error(`Erreur HTTP: ${jobsResponse.status}`);
                }
                
                const jobsData = await jobsResponse.json();
                console.log('Données brutes reçues:', jobsData);
                
                // CORRECTION : Gérer la structure des données de Netlify CMS
                // Netlify CMS peut stocker les données de différentes manières
                if (jobsData.content && Array.isArray(jobsData.content)) {
                    // Structure normale : { content: [...] }
                    JOBS = jobsData.content;
                } else if (Array.isArray(jobsData)) {
                    // Structure alternative : tableau direct
                    JOBS = jobsData;
                } else {
                    // Structure avec entrées individuelles
                    JOBS = Object.values(jobsData).filter(item => 
                        item && typeof item === 'object' && item.title
                    );
                }
                
                console.log(`${JOBS.length} offres d'emploi trouvées`);
                
                // S'assurer que chaque offre a un ID
                JOBS = JOBS.map((job, index) => {
                    if (!job.id) {
                        job.id = 'job-' + (index + 1) + '-' + Date.now();
                    }
                    // S'assurer que les compétences sont un tableau
                    if (!Array.isArray(job.skills)) {
                        if (typeof job.skills === 'string') {
                            job.skills = job.skills.split(',').map(s => s.trim()).filter(s => s);
                        } else {
                            job.skills = [];
                        }
                    }
                    return job;
                });
                
                // Trier les offres par date (les plus récentes en premier)
                JOBS.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Mettre à jour l'état de l'application
                filteredJobs = [...JOBS];
                jobsLoaded = true;
                
                // Afficher les offres
                renderJobs(filteredJobs);
                updatePagination();
                
                // Cacher l'indicateur de chargement
                document.querySelector('.loading').style.display = 'none';
                
                console.log(`${JOBS.length} offres d'emploi chargées avec succès`);
                
            } catch (error) {
                console.error('Erreur lors du chargement des offres:', error);
                
                // Afficher un message d'erreur
                document.getElementById('jobs').innerHTML = `
                    <div class="bg-white rounded-xl p-8 text-center shadow-sm border border-gray-100">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-300 mb-4"></i>
                        <h3 class="text-lg font-semibold text-gray-700">Erreur de chargement</h3>
                        <p class="text-gray-500 mt-2">Impossible de charger les offres d'emploi. Veuillez réessayer plus tard.</p>
                        <p class="text-gray-400 text-sm mt-2">${error.message}</p>
                        <button class="mt-4 px-4 py-2 btn-primary text-white rounded-lg text-sm" onclick="loadJobsFromJSON()">
                            <i class="fas fa-redo mr-2"></i> Réessayer
                        </button>
                    </div>
                `;
                
                document.querySelector('.loading').style.display = 'none';
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Initialiser l'année du copyright
            document.getElementById('year').textContent = new Date().getFullYear();
            
            // Charger les offres d'emploi
            loadJobsFromJSON();
            
            // Configurer les événements
            setupEventListeners();
            
            // Configurer le menu mobile
            setupMobileMenu();
            
            // Configurer l'analyseur de CV
            setupCVAnalyzer();
            
            // Configurer le téléchargement PDF
            setupPDFUpload();
            
            // Initialiser Netlify Identity
            if (window.netlifyIdentity) {
                window.netlifyIdentity.on("init", user => {
                    if (!user) {
                        window.netlifyIdentity.on("login", () => {
                            document.location.href = "/admin/";
                        });
                    }
                });
            }
        }

        function setupEventListeners() {
            // Recherche
            document.getElementById('searchForm').addEventListener('submit', function(e) {
                e.preventDefault();
                filterJobs();
            });
            
            // Filtres
            document.getElementById('applyFilters').addEventListener('click', filterJobs);
            document.getElementById('clearFilters').addEventListener('click', clearFilters);
            
            // Pagination
            document.getElementById('prev').addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    renderJobs(filteredJobs);
                    updatePagination();
                    window.scrollTo({ top: document.getElementById('offres').offsetTop - 100, behavior: 'smooth' });
                }
            });
            
            document.getElementById('next').addEventListener('click', function() {
                const maxPage = Math.ceil(filteredJobs.length / jobsPerPage);
                if (currentPage < maxPage) {
                    currentPage++;
                    renderJobs(filteredJobs);
                    updatePagination();
                    window.scrollTo({ top: document.getElementById('offres').offsetTop - 100, behavior: 'smooth' });
                }
            });
            
            // Suggestions de recherche
            document.querySelectorAll('.suggestion-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const suggestion = this.getAttribute('data-suggestion');
                    document.getElementById('q').value = suggestion;
                    filterJobs();
                });
            });
            
            // Modales
            document.getElementById('conditionsLink').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('conditionsModal').style.display = 'block';
            });
            
            document.getElementById('privacyLink').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('privacyModal').style.display = 'block';
            });
            
            document.querySelectorAll('.close').forEach(closeBtn => {
                closeBtn.addEventListener('click', function() {
                    const modalId = this.getAttribute('data-modal');
                    document.getElementById(modalId).style.display = 'none';
                });
            });
            
            // Fermer les modales en cliquant à l'extérieur
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
        }

        function setupMobileMenu() {
            const menuBtn = document.getElementById('mobileMenuBtn');
            const mobileMenu = document.getElementById('mobileMenu');
            
            menuBtn.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
            });
            
            // Fermer le menu en cliquant sur un lien
            mobileMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', function() {
                    mobileMenu.classList.add('hidden');
                });
            });
        }

        function setupCVAnalyzer() {
            document.getElementById('submit-cv-info').addEventListener('click', validateCVInfoForm);
            document.getElementById('analyze-btn').addEventListener('click', analyzeCV);
            document.getElementById('save-result-btn').addEventListener('click', saveAnalysisResult);
        }

        function setupPDFUpload() {
            const pdfInput = document.getElementById('cv-pdf');
            const pdfUploadContainer = document.getElementById('pdfUploadContainer');
            const pdfPreview = document.getElementById('pdf-preview');
            const removePdfBtn = document.getElementById('remove-pdf');
            
            // Ouvrir le sélecteur de fichiers en cliquant sur le conteneur
            pdfUploadContainer.addEventListener('click', function() {
                pdfInput.click();
            });
            
            // Gérer la sélection de fichier
            pdfInput.addEventListener('change', function(e) {
                if (this.files && this.files[0]) {
                    const file = this.files[0];
                    
                    // Vérifier la taille du fichier (max 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        alert('Le fichier est trop volumineux. Taille maximale: 5MB');
                        this.value = '';
                        return;
                    }
                    
                    // Afficher le nom du fichier
                    document.getElementById('pdf-filename').textContent = file.name;
                    
                    // Afficher la prévisualisation
                    pdfPreview.style.display = 'block';
                    
                    // Extraire le texte du PDF
                    extractTextFromPDF(file).then(text => {
                        document.getElementById('pdf-extracted-text').textContent = text;
                        document.getElementById('cv-text').value = text;
                    }).catch(error => {
                        console.error('Erreur lors de l\'extraction du texte:', error);
                        document.getElementById('pdf-extracted-text').textContent = 'Impossible d\'extraire le texte de ce PDF. Veuillez coller le texte manuellement.';
                    });
                }
            });
            
            // Supprimer le PDF sélectionné
            removePdfBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                pdfInput.value = '';
                pdfPreview.style.display = 'none';
                document.getElementById('cv-text').value = '';
            });
        }

        function validateCVInfoForm() {
            const educationLevel = document.getElementById('education-level').value;
            const yearsExperience = document.getElementById('years-experience').value;
            
            if (!educationLevel) {
                alert('Veuillez sélectionner votre niveau d\'études.');
                return;
            }
            
            if (!yearsExperience || yearsExperience < 0) {
                alert('Veuillez saisir un nombre valide d\'années d\'expérience.');
                return;
            }
            
            // Enregistrer les informations utilisateur
            userEducationLevel = educationLevel;
            userExperienceYears = parseFloat(yearsExperience);
            
            // Masquer le formulaire et afficher le contenu d'analyse
            document.getElementById('cvInfoForm').classList.add('hidden');
            document.getElementById('cv-analysis-content').classList.remove('hidden');
        }

        function extractTextFromPDF(file) {
            return new Promise((resolve, reject) => {
                const fileReader = new FileReader();
                
                fileReader.onload = function() {
                    const typedarray = new Uint8Array(this.result);
                    
                    // Charger le document PDF
                    pdfjsLib.getDocument(typedarray).promise.then(pdf => {
                        let text = '';
                        const numPages = pdf.numPages;
                        
                        // Extraire le texte de chaque page
                        const extractPage = (pageNum) => {
                            return pdf.getPage(pageNum).then(page => {
                                return page.getTextContent();
                            }).then(textContent => {
                                // Nouvelle méthode: préserver les sauts de ligne
                                let lastY, line = '';
                                let pageText = [];
                                
                                // Trier les items par position verticale (du haut vers le bas)
                                textContent.items.sort((a, b) => {
                                    // Tri par Y décroissant pour avoir le haut de page en premier
                                    return b.transform[5] - a.transform[5];
                                });
                                
                                for (let item of textContent.items) {
                                    if (lastY === undefined) {
                                        lastY = item.transform[5];
                                        line = item.str;
                                    } else if (lastY !== item.transform[5]) {
                                        // Nouvelle ligne
                                        pageText.push(line);
                                        line = item.str;
                                        lastY = item.transform[5];
                                    } else {
                                        // Même ligne
                                        line += ' ' + item.str;
                                    }
                                }
                                // Ajouter la dernière ligne
                                pageText.push(line);
                                
                                text += pageText.join('\n') + '\n\n';
                                
                                if (pageNum < numPages) {
                                    return extractPage(pageNum + 1);
                                } else {
                                    return text;
                                }
                            }).catch(error => {
                                reject(error);
                            });
                        };
                        
                        // Commencer l'extraction à partir de la première page
                        extractPage(1).then(resolve).catch(reject);
                    }).catch(reject);
                };
                
                fileReader.readAsArrayBuffer(file);
            });
        }

        function filterJobs() {
            if (!jobsLoaded) {
                alert('Les offres d\'emploi sont en cours de chargement. Veuillez patienter.');
                return;
            }
            
            // Afficher l'indicateur de chargement
            document.querySelector('.loading').style.display = 'block';
            document.getElementById('jobs').innerHTML = '';
            
            // Simuler un délai de chargement pour une meilleure UX
            setTimeout(() => {
                const searchTerm = document.getElementById('q').value.trim().toLowerCase();
                const locationTerm = document.getElementById('location').value.trim().toLowerCase();
                const contractFilter = document.getElementById('contract').value;
                const sectorFilter = document.getElementById('sector').value;
                const dateFilter = document.getElementById('datePosted').value;
                
                // Mettre à jour les filtres actifs
                activeFilters = {
                    search: searchTerm,
                    location: locationTerm,
                    contract: contractFilter,
                    sector: sectorFilter,
                    date: dateFilter
                };
                
                // Filtrer les emplois
                filteredJobs = JOBS.filter(job => {
                    // Filtre par terme de recherche
                    if (searchTerm && !(
                        job.title.toLowerCase().includes(searchTerm) || 
                        job.company.toLowerCase().includes(searchTerm) ||
                        (job.description && job.description.toLowerCase().includes(searchTerm)) ||
                        (job.requirements && job.requirements.toLowerCase().includes(searchTerm))
                    )) {
                        return false;
                    }
                    
                    // Filtre par localisation
                    if (locationTerm && job.location && !job.location.toLowerCase().includes(locationTerm)) {
                        return false;
                    }
                    
                    // Filtre par type de contrat
                    if (contractFilter && job.type !== contractFilter) {
                        return false;
                    }
                    
                    // Filtre par secteur
                    if (sectorFilter && job.sector !== sectorFilter) {
                        return false;
                    }
                    
                    // Filtre par date
                    if (dateFilter) {
                        const jobDate = new Date(job.date);
                        if (isNaN(jobDate.getTime())) return false;
                        
                        const daysDiff = Math.floor((new Date() - jobDate) / (1000 * 60 * 60 * 24));
                        if (daysDiff > parseInt(dateFilter)) {
                            return false;
                        }
                    }
                    
                    return true;
                });
                
                // Réinitialiser à la première page
                currentPage = 1;
                
                // Afficher les résultats
                renderJobs(filteredJobs);
                updatePagination();
                
                // Mettre à jour l'indicateur de filtres actifs
                updateFilterIndicator();
                
                // Cacher l'indicateur de chargement
                document.querySelector('.loading').style.display = 'none';
            }, 500);
        }

        function clearFilters() {
            document.getElementById('q').value = '';
            document.getElementById('location').value = '';
            document.getElementById('contract').value = '';
            document.getElementById('sector').value = '';
            document.getElementById('datePosted').value = '';
            
            activeFilters = {};
            filteredJobs = [...JOBS];
            currentPage = 1;
            
            renderJobs(filteredJobs);
            updatePagination();
            updateFilterIndicator();
        }

        function updateFilterIndicator() {
            const indicator = document.getElementById('filterIndicator');
            const activeFiltersCount = Object.values(activeFilters).filter(val => val !== '').length;
            
            if (activeFiltersCount > 0) {
                indicator.classList.remove('hidden');
                indicator.textContent = `${activeFiltersCount} filtre(s) actif(s)`;
            } else {
                indicator.classList.add('hidden');
            }
        }

        function renderJobs(jobs) {
            const container = document.getElementById('jobs');
            container.innerHTML = '';
            
            const startIndex = (currentPage - 1) * jobsPerPage;
            const endIndex = startIndex + jobsPerPage;
            const jobsToRender = jobs.slice(startIndex, endIndex);
            
            document.getElementById('count').textContent = jobs.length;
            
            if (jobsToRender.length === 0) {
                container.innerHTML = `
                    <div class="bg-white rounded-xl p-8 text-center shadow-sm border border-gray-100">
                        <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
                        <h3 class="text-lg font-semibold text-gray-700">Aucune offre trouvée</h3>
                        <p class="text-gray-500 mt-2">Essayez de modifier vos critères de recherche ou <a href="#" id="clearSearch" class="text-primary-600 hover:underline">réinitialiser les filtres</a>.</p>
                    </div>
                `;
                
                document.getElementById('clearSearch').addEventListener('click', function(e) {
                    e.preventDefault();
                    clearFilters();
                });
                
                return;
            }
            
            jobsToRender.forEach(job => {
                const card = document.createElement('article');
                card.className = 'card bg-white rounded-xl p-5 shadow-sm border border-gray-100 relative';
                
                // Vérifier s'il y a un score enregistré pour cette offre
                const savedScores = JSON.parse(localStorage.getItem('cvScores') || '{}');
                const jobScore = savedScores[job.id];
                
                // Formater les dates
                let formattedDate = 'Date non spécifiée';
                let formattedExpirationDate = 'Date non spécifiée';
                
                try {
                    if (job.date) {
                        formattedDate = new Date(job.date).toLocaleDateString('fr-FR', {
                            day: 'numeric',
                            month: 'long',
                            year: 'numeric'
                        });
                    }
                    
                    if (job.expirationDate) {
                        formattedExpirationDate = new Date(job.expirationDate).toLocaleDateString('fr-FR', {
                            day: 'numeric',
                            month: 'long',
                            year: 'numeric'
                        });
                    }
                } catch (e) {
                    console.error('Erreur de formatage de date:', e);
                }
                
                card.innerHTML = `
                    ${jobScore ? `<div class="job-match-badge"><i class="fas fa-chart-line mr-1"></i> ${jobScore}%</div>` : ''}
                    <div class="flex flex-col md:flex-row gap-5">
                        <div class="flex-1">
                            <h4 class="text-lg font-semibold text-gray-800">${job.title || 'Titre non spécifié'}</h4>
                            <div class="flex items-center mt-2 text-gray-600">
                                <i class="fas fa-building mr-2 text-sm"></i>
                                <span class="text-sm">${job.company || 'Entreprise non spécifiée'}</span>
                            </div>
                            
                            <div class="flex flex-wrap mt-4 gap-2">
                                <span class="tag tag-location">
                                    <i class="fas fa-map-marker-alt mr-1"></i> ${job.location || 'Lieu non spécifié'}
                                </span>
                                <span class="tag tag-contract">${job.type || 'Type non spécifié'}</span>
                                <span class="tag tag-sector">${job.sector || 'Secteur non spécifié'}</span>
                                <span class="tag tag-date">
                                    <i class="far fa-calendar-alt mr-1"></i> Publié: ${formattedDate}
                                </span>
                                <span class="tag tag-date">
                                    <i class="fas fa-hourglass-end mr-1"></i> Expire: ${formattedExpirationDate}
                                </span>
                            </div>
                        </div>
                        
                        <div class="md:w-1/3 flex flex-col justify-between">
                            <div class="mt-4 flex flex-col sm:flex-row gap-2">
                                <button class="view-btn px-4 py-2 border border-primary-600 text-primary-600 rounded-lg text-sm font-medium hover:bg-primary-50 transition-colors flex items-center justify-center">
                                    <i class="fas fa-eye mr-2"></i> Voir détails
                                </button>
                                <button class="analyze-cv-btn px-4 py-2 border border-green-600 text-green-600 rounded-lg text-sm font-medium hover:bg-green-50 transition-colors flex items-center justify-center" data-job-id="${job.id}">
                                    <i class="fas fa-chart-line mr-2"></i> Analyser CV
                                </button>
                                <a href="https://wa.me/22790143507?text=Je%20suis%20intéressé%20par%20l'offre%20${encodeURIComponent(job.title || '')}%20de%20${encodeURIComponent(job.company || '')}" 
                                   class="px-4 py-2 btn-primary text-white rounded-lg text-sm font-medium text-center flex items-center justify-center">
                                    <i class="fab fa-whatsapp mr-2"></i> WhatsApp
                                </a>
                                <a href="mailto:abdoulazizeaboubacare@yahoo.fr?subject=Candidature%20pour%20le%20poste%20${encodeURIComponent(job.title || '')}&body=Je%20souhaite%20postuler%20pour%20le%20poste%20de%20${encodeURIComponent(job.title || '')}%20chez%20${encodeURIComponent(job.company || '')}" 
                                   class="px-4 py-2 btn-secondary text-white rounded-lg text-sm font-medium text-center flex items-center justify-center">
                                    <i class="fas fa-envelope mr-2"></i> Email
                                </a>
                            </div>
                        </div>
                    </div>
                `;
                
                // Ajouter l'événement pour le bouton "Voir détails"
                const viewBtn = card.querySelector('.view-btn');
                viewBtn.addEventListener('click', () => showJobDetails(job));
                
                // Ajouter l'événement pour le bouton "Analyser CV"
                const analyzeBtn = card.querySelector('.analyze-cv-btn');
                analyzeBtn.addEventListener('click', function() {
                    currentJobIdForAnalysis = this.getAttribute('data-job-id');
                    const jobData = JOBS.find(j => j.id == currentJobIdForAnalysis);
                    if (jobData) {
                        document.getElementById('job-desc').value = (jobData.description || '') + "\n\nCompétences requises: " + (jobData.requirements || '');
                        
                        // Réinitialiser et afficher le formulaire d'informations
                        document.getElementById('cvInfoForm').classList.remove('hidden');
                        document.getElementById('cv-analysis-content').classList.add('hidden');
                        document.getElementById('analyzer-result').classList.add('hidden');
                        
                        document.getElementById('analyse-cv').scrollIntoView({ behavior: 'smooth' });
                    }
                });
                
                container.appendChild(card);
            });
        }

        function showJobDetails(job) {
            // Formater les dates
            let formattedDate = 'Date non spécifiée';
            let formattedExpirationDate = 'Date non spécifiée';
            
            try {
                if (job.date) {
                    formattedDate = new Date(job.date).toLocaleDateString('fr-FR', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    });
                }
                
                if (job.expirationDate) {
                    formattedExpirationDate = new Date(job.expirationDate).toLocaleDateString('fr-FR', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    });
                }
            } catch (e) {
                console.error('Erreur de formatage de date:', e);
            }
            
            // Vérifier s'il y a un score enregistré pour cette offre
            const savedScores = JSON.parse(localStorage.getItem('cvScores') || '{}');
            const jobScore = savedScores[job.id];
            
            // Créer le contenu du modal de détails
            const modalContent = `
                <div class="modal-content" style="max-height: 85vh; overflow-y: auto;">
                    <span class="close">&times;</span>
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">${job.title || 'Titre non spécifié'}</h2>
                        <div class="flex items-center mt-2 text-gray-600">
                            <i class="fas fa-building mr-2"></i>
                            <span>${job.company || 'Entreprise non spécifiée'}</span>
                        </div>
                        ${jobScore ? `<div class="mt-2 inline-block bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm"><i class="fas fa-chart-line mr-1"></i> Votre score de correspondance: ${jobScore}%</div>` : ''}
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-500">Lieu</div>
                            <div class="font-medium"><i class="fas fa-map-marker-alt mr-2 text-primary-600"></i> ${job.location || 'Non spécifié'}</div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-500">Type de contrat</div>
                            <div class="font-medium"><i class="fas fa-file-contract mr-2 text-primary-600"></i> ${job.type || 'Non spécifié'}</div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-500">Secteur</div>
                            <div class="font-medium"><i class="fas fa-industry mr-2 text-primary-600"></i> ${job.sector || 'Non spécifié'}</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-500">Date de publication</div>
                            <div class="font-medium"><i class="far fa-calendar-alt mr-2 text-primary-600"></i> ${formattedDate}</div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-500">Date d'expiration</div>
                            <div class="font-medium"><i class="fas fa-hourglass-end mr-2 text-primary-600"></i> ${formattedExpirationDate}</div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3">Description du poste</h3>
                        <p class="text-gray-700">${job.description || 'Aucune description disponible.'}</p>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3">Profil recherché</h3>
                        <ul class="list-disc pl-5 text-gray-700 space-y-2">
                            <li>Niveau d'éducation: ${job.education || 'Non spécifié'}</li>
                            <li>Expérience: ${job.experience || 'Non spécifié'}</li>
                            <li>Compétences: ${Array.isArray(job.skills) ? job.skills.join(', ') : (job.skills || 'Non spécifiées')}</li>
                        </ul>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t border-gray-200">
                        <button class="px-6 py-3 border border-green-600 text-green-600 rounded-lg font-medium hover:bg-green-50 transition-colors flex items-center justify-center" id="analyzeFromModal" data-job-id="${job.id}">
                            <i class="fas fa-chart-line mr-2 text-lg"></i> Analyser mon CV
                        </button>
                        <a href="https://wa.me/22790143507?text=Je%20suis%20intéressé%20par%20l'offre%20${encodeURIComponent(job.title || '')}%20de%20${encodeURIComponent(job.company || '')}" 
                           class="px-6 py-3 btn-primary text-white rounded-lg font-medium text-center flex items-center justify-center">
                            <i class="fab fa-whatsapp mr-2 text-lg"></i> Postuler via WhatsApp
                        </a>
                        <a href="mailto:abdoulazizeaboubacare@yahoo.fr?subject=Candidature%20pour%20le%20poste%20${encodeURIComponent(job.title || '')}&body=Je%20souhaite%20postuler%20pour%20le%20poste%20de%20${encodeURIComponent(job.title || '')}%20chez%20${encodeURIComponent(job.company || '')}" 
                           class="px-6 py-3 btn-secondary text-white rounded-lg font-medium text-center flex items-center justify-center">
                            <i class="fas fa-envelope mr-2 text-lg"></i> Postuler par email
                        </a>
                        <button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors" id="closeDetails">
                            Fermer
                        </button>
                    </div>
                </div>
            `;
            
            // Créer et afficher le modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = modalContent;
            document.body.appendChild(modal);
            modal.style.display = 'block';
            
            // Configurer les événements de fermeture
            const closeBtn = modal.querySelector('.close');
            closeBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            const closeDetailsBtn = modal.querySelector('#closeDetails');
            closeDetailsBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            // Configurer le bouton d'analyse depuis le modal
            const analyzeFromModalBtn = modal.querySelector('#analyzeFromModal');
            analyzeFromModalBtn.addEventListener('click', function() {
                currentJobIdForAnalysis = this.getAttribute('data-job-id');
                const jobData = JOBS.find(j => j.id == currentJobIdForAnalysis);
                if (jobData) {
                    document.getElementById('job-desc').value = (jobData.description || '') + "\n\nCompétences requises: " + (jobData.requirements || '');
                    
                    // Réinitialiser et afficher le formulaire d'informations
                    document.getElementById('cvInfoForm').classList.remove('hidden');
                    document.getElementById('cv-analysis-content').classList.add('hidden');
                    document.getElementById('analyzer-result').classList.add('hidden');
                    
                    document.body.removeChild(modal);
                    document.getElementById('analyse-cv').scrollIntoView({ behavior: 'smooth' });
                }
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredJobs.length / jobsPerPage);
            document.getElementById('paginationInfo').textContent = `Page ${currentPage} sur ${totalPages}`;
            
            document.getElementById('prev').disabled = currentPage === 1;
            document.getElementById('next').disabled = currentPage === totalPages || totalPages === 0;
        }

        // ==============================================
        // ALGORITHMES D'ANALYSE DE CV AVANCÉS
        // ==============================================

        function analyzeCV() {
            let cvText = document.getElementById('cv-text').value;
            const jobText = document.getElementById('job-desc').value;
            
            if (!cvText || !jobText) {
                alert('Veuillez remplir les deux champs pour analyser votre CV.');
                return;
            }
            
            // Afficher l'indicateur de chargement
            document.getElementById('analyzer-result').classList.add('hidden');
            document.getElementById('analyze-btn').disabled = true;
            document.getElementById('analyze-btn').textContent = 'Analyse en cours...';
            
            // Simuler un délai de traitement pour l'UX
            setTimeout(() => {
                // Analyser le CV avec des algorithmes avancés
                const analysis = advancedCVAnalysis(cvText, jobText);
                currentAnalysisResult = analysis;
                
                // Afficher les résultats
                displayAnalysisResults(analysis);
                
                // Réactiver le bouton
                document.getElementById('analyze-btn').disabled = false;
                document.getElementById('analyze-btn').textContent = 'Analyser la correspondance';
            }, 1500);
        }

        function advancedCVAnalysis(cvText, jobText) {
            // Nettoyer et prétraiter les textes
            const cleanCV = preprocessText(cvText);
            const cleanJob = preprocessText(jobText);
            
            // Analyser la structure du CV
            const cvStructure = analyzeCVStructure(cvText);
            
            // Extraire les informations structurées du CV
            const cvInfo = extractCVInformation(cvText, cvStructure);
            
            // Utiliser les informations fournies par l'utilisateur
            cvInfo.education = userEducationLevel;
            cvInfo.experience = userExperienceYears;
            
            // Extraire les mots-clés uniquement de la description du poste
            const jobKeywords = extractKeywordsFromJobDescription(jobText);
            
            // Extraire les mots-clés du CV
            const cvKeywords = extractKeywordsFromCV(cvText, cvStructure);
            
            // Calculer la similarité cosinus entre les deux textes
            const similarityScore = calculateWeightedSimilarity(cvInfo, cleanJob);
            
            // Identifier les compétences correspondantes et manquantes
            const { matched, missing } = compareKeywords(cvKeywords, jobKeywords);
            
            return {
                score: Math.round(similarityScore * 100),
                matchedKeywords: matched,
                missingKeywords: missing,
                experience: cvInfo.experience,
                educationLevel: cvInfo.education,
                suggestions: generateSuggestions(matched, missing, cvInfo.experience, cvInfo.education),
                cvInfo: cvInfo
            };
        }

        function analyzeCVStructure(cvText) {
            const structure = {
                hasSummary: false,
                hasExperience: false,
                hasEducation: false,
                hasSkills: false,
                sections: []
            };
            
            // Détecter les sections courantes dans un CV
            const sectionPatterns = [
                { pattern: /(résumé|summary|profil|profile|objectif)/i, name: "summary" },
                { pattern: /(expérience|expériences|experience|experiences|emploi|employment|historique professionnel)/i, name: "experience" },
                { pattern: /(formation|éducation|education|études|diplômes|academic)/i, name: "education" },
                { pattern: /(compétences|skills|connaissances|competences|aptitudes)/i, name: "skills" },
                { pattern: /(langues|languages|langage)/i, name: "languages" },
                { pattern: /(certifications|certificats|certificates)/i, name: "certifications" },
                { pattern: /(projets|projects|réalisations)/i, name: "projects" },
                { pattern: /(centres d'intérêt|intérêts|hobbies|loisirs)/i, name: "interests" }
            ];
            
            // Diviser le CV en lignes
            const lines = cvText.split('\n');
            
            // Identifier les sections
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line.length > 0) {
                    for (const section of sectionPatterns) {
                        if (section.pattern.test(line) && line.length < 50) { // Éviter les faux positifs dans le texte courant
                            structure.sections.push({
                                name: section.name,
                                title: line,
                                startIndex: i
                            });
                            
                            // Marquer la présence de cette section
                            structure[`has${section.name.charAt(0).toUpperCase() + section.name.slice(1)}`] = true;
                            break;
                        }
                    }
                }
            }
            
            // Trier les sections par ordre d'apparition
            structure.sections.sort((a, b) => a.startIndex - b.startIndex);
            
            return structure;
        }

        function extractCVInformation(cvText, structure) {
            const info = {
                experience: userExperienceYears || 0,
                education: userEducationLevel || "",
                skills: [],
                languages: [],
                certifications: []
            };
            
            const lines = cvText.split('\n');
            
            // Extraire les compétences
            info.skills = extractSkills(cvText, structure);
            
            // Extraire les langues
            info.languages = extractLanguages(cvText);
            
            // Extraire les certifications
            info.certifications = extractCertifications(cvText);
            
            return info;
        }

        function extractSkills(cvText, structure) {
            const skills = [];
            
            // Expressions régulières pour détecter les compétences en français
            const skillPatterns = [
                // Compétences techniques
                /(html|css|javascript|java|python|php|ruby|node\.js|react|angular|vue|sql|mongodb|postgresql|mysql)/gi,
                // Compétences métier
                /(gestion de projet|management|marketing|ventes|communication|rédaction|analyse|budget|finance|comptabilité)/gi,
                // Logiciels
                /(word|excel|powerpoint|outlook|photoshop|illustrator|indesign|autocad|spss|stata)/gi
            ];
            
            // Extraire les compétences à partir des motifs
            skillPatterns.forEach(pattern => {
                const matches = cvText.match(pattern);
                if (matches) {
                    matches.forEach(match => {
                        if (!skills.includes(match.toLowerCase())) {
                            skills.push(match.toLowerCase());
                        }
                    });
                }
            });
            
            // Si une section compétences a été identifiée, l'analyser spécifiquement
            const skillsSection = structure.sections.find(s => s.name === 'skills');
            if (skillsSection) {
                const lines = cvText.split('\n');
                let inSkillsSection = false;
                
                for (let i = skillsSection.startIndex + 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    // Sortir de la section si on rencontre une nouvelle section
                    if (line.length > 0 && i > skillsSection.startIndex + 2) {
                        const isNewSection = structure.sections.some(s => 
                            s.startIndex === i && s.name !== skillsSection.name
                        );
                        if (isNewSection) break;
                    }
                    
                    // Ajouter les compétences de cette ligne
                    if (line.length > 0) {
                        // Séparer par des virgules, points-virgules, tirets, etc.
                        const lineSkills = line.split(/[,;:\-•·]/).map(s => s.trim()).filter(s => s.length > 0);
                        lineSkills.forEach(skill => {
                            if (skill.length > 2 && skill.length < 50 && !skills.includes(skill.toLowerCase())) {
                                skills.push(skill.toLowerCase());
                            }
                        });
                    }
                }
            }
            
            return skills.slice(0, 20); // Limiter à 20 compétences
        }

        function extractLanguages(cvText) {
            const languages = [];
            const languagePattern = /(français|anglais|espagnol|allemand|arabe|chinois|russe|portugais|italien|japonais)/gi;
            
            const matches = cvText.match(languagePattern);
            if (matches) {
                matches.forEach(match => {
                    if (!languages.includes(match.toLowerCase())) {
                        languages.push(match.toLowerCase());
                    }
                });
            }
            
            return languages;
        }

        function extractCertifications(cvText) {
            const certifications = [];
            const certPattern = /(certificat|certification|diplôme|agréé|accrédité|pmp|scrum|agile|six sigma|toeic|toefl|ielts)/gi;
            
            const lines = cvText.split('\n');
            for (const line of lines) {
                if (certPattern.test(line)) {
                    certifications.push(line.trim());
                    if (certifications.length >= 5) break; // Limiter à 5 certifications
                }
            }
            
            return certifications;
        }

        function extractKeywordsFromCV(cvText, structure) {
            // Pondérer les mots-clés en fonction de leur position dans le CV
            const lines = cvText.split('\n');
            const keywords = {};
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line.length > 3) {
                    // Déterminer le poids en fonction de la position
                    let weight = 1;
                    
                    // Les premières lignes (résumé) ont plus de poids
                    if (i < 10) weight = 3;
                    // Les titres de section ont plus de poids
                    else if (line.length < 50 && /[A-Z]/.test(line)) weight = 2.5;
                    // Les lignes dans la section compétences ont plus de poids
                    else if (isInSection(i, structure, 'skills')) weight = 2;
                    // Les lignes dans la section expérience ont un poids modéré
                    else if (isInSection(i, structure, 'experience')) weight = 1.5;
                    
                    // Extraire les mots significatifs de cette ligne
                    const words = preprocessText(line).split(' ');
                    
                    // Ajouter les unigrammes
                    for (const word of words) {
                        if (word.length > 3) { // Ignorer les mots trop courts
                            keywords[word] = (keywords[word] || 0) + weight;
                        }
                    }
                    
                    // Ajouter les bigrammes (combinaisons de deux mots)
                    for (let j = 0; j < words.length - 1; j++) {
                        if (words[j].length > 2 && words[j+1].length > 2) {
                            const bigram = words[j] + ' ' + words[j+1];
                            keywords[bigram] = (keywords[bigram] || 0) + weight;
                        }
                    }
                }
            }
            
            // Trier par poids
            const sortedKeywords = Object.entries(keywords)
                .sort((a, b) => b[1] - a[1])
                .map(entry => entry[0]);
            
            return sortedKeywords.slice(0, 40); // Retourner les 40 mots-clés les plus importants
        }

        function extractKeywordsFromJobDescription(jobText) {
            // Extraire les mots-clés uniquement de la description du poste
            const cleanJob = preprocessText(jobText);
            const words = cleanJob.split(' ');
            
            // Compter la fréquence des mots
            const wordFreq = {};
            words.forEach(word => {
                if (word.length > 3) { // Ignorer les mots trop courts
                    wordFreq[word] = (wordFreq[word] || 0) + 1;
                }
            });
            
            // Ajouter les bigrammes
            for (let i = 0; i < words.length - 1; i++) {
                if (words[i].length > 2 && words[i+1].length > 2) {
                    const bigram = words[i] + ' ' + words[i+1];
                    wordFreq[bigram] = (wordFreq[bigram] || 0) + 1;
                }
            }
            
            // Trier par fréquence
            const sortedWords = Object.keys(wordFreq).sort((a, b) => wordFreq[b] - wordFreq[a]);
            
            // Retourner les 25 mots les plus significatifs
            return sortedWords.slice(0, 25);
        }

        function isInSection(lineIndex, structure, sectionName) {
            const section = structure.sections.find(s => s.name === sectionName);
            if (!section) return false;
            
            let endIndex = lineIndex + 1;
            const nextSectionIndex = structure.sections.findIndex(s => s.startIndex > section.startIndex);
            
            if (nextSectionIndex !== -1) {
                endIndex = structure.sections[nextSectionIndex].startIndex;
            }
            
            return lineIndex > section.startIndex && lineIndex < endIndex;
        }

        function calculateWeightedSimilarity(cvInfo, jobText) {
            // Calculer un score de similarité pondéré basé sur différentes dimensions
            
            let totalScore = 0;
            let maxScore = 0;
            
            // 1. Similarité des compétences (40%)
            const jobSkills = extractKeywordsFromJobDescription(jobText);
            const skillMatches = cvInfo.skills.filter(skill => 
                jobSkills.some(jobSkill => jobSkill.includes(skill) || skill.includes(jobSkill))
            ).length;
            
            const skillScore = skillMatches / Math.max(jobSkills.length, 1);
            totalScore += skillScore * 0.4;
            maxScore += 0.4;
            
            // 2. Correspondance de l'expérience (25%)
            // Extraire l'expérience requise depuis la description de poste
            const jobExp = extractExperienceFromJob(jobText);
            let expScore = 0;
            if (jobExp > 0) {
                if (cvInfo.experience >= jobExp) {
                    expScore = 1;
                } else {
                    expScore = cvInfo.experience / jobExp;
                }
            }
            totalScore += expScore * 0.25;
            maxScore += 0.25;
            
            // 3. Correspondance de l'éducation (15%)
            const jobEducation = extractEducationLevelFromJob(jobText);
            let educationScore = 0;
            
            // Hiérarchie des niveaux d'éducation
            const educationLevels = {
                "Niveau non spécifié": 0,
                "CFEPD": 1,
                "BEPC": 2,
                "BAC": 3,
                "BTS": 4,
                "LICENCE": 5,
                "MASTER": 6,
                "DOCTORAT": 7,
                "AUTRE": 0
            };
            
            if (jobEducation !== "Niveau non spécifié") {
                const cvLevel = educationLevels[cvInfo.education] || 0;
                const jobLevel = educationLevels[jobEducation] || 0;
                
                if (cvLevel >= jobLevel) {
                    educationScore = 1;
                } else {
                    educationScore = cvLevel / Math.max(jobLevel, 1);
                }
            }
            
            totalScore += educationScore * 0.15;
            maxScore += 0.15;
            
            // 4. Similarité textuelle générale (20%)
            const cleanCV = preprocessText(JSON.stringify(cvInfo));
            const similarityScore = calculateCosineSimilarity(cleanCV, jobText);
            totalScore += similarityScore * 0.2;
            maxScore += 0.2;
            
            // Normaliser le score
            return totalScore / maxScore;
        }

        function extractExperienceFromJob(jobText) {
            // Expressions régulières pour détecter l'expérience requise dans l'offre d'emploi
            const experiencePatterns = [
                /(\d+)\s*(ans|années|année|an)(?:\s*.*?)(?:d'|d\s)?expérience/gi,
                /expérience.*?(\d+)\s*(ans|années|année|an)/gi,
                /(\d+)\s*-\s*(\d+)\s*(ans|années|année|an).*?expérience/gi,
                /(\d+)\s*\/\s*(\d+)\s*(ans|années|année|an).*?expérience/gi
            ];
            
            let maxExperience = 0;
            
            experiencePatterns.forEach(pattern => {
                const matches = jobText.match(pattern);
                if (matches) {
                    matches.forEach(match => {
                        // Extraire les nombres de l'expression
                        const numbers = match.match(/\d+/g);
                        if (numbers) {
                            // Prendre le plus grand nombre trouvé dans cette expression
                            const maxInMatch = Math.max(...numbers.map(n => parseInt(n)));
                            if (maxInMatch > maxExperience) {
                                maxExperience = maxInMatch;
                            }
                        }
                    });
                }
            });
            
            return maxExperience;
        }

        function extractEducationLevelFromJob(jobText) {
            // Détecter le niveau d'éducation requis dans l'offre d'emploi
            const educationPatterns = [
                { pattern: /doctorat|phd|d\.?phil|thèse/i, level: "DOCTORAT" },
                { pattern: /master|mastère|mba|bac\s*\+?\s*5/i, level: "MASTER" },
                { pattern: /licence|bachelor|bac\s*\+?\s*[34]/i, level: "LICENCE" },
                { pattern: /bts|dut|deug|bac\s*\+?\s*2/i, level: "BTS" },
                { pattern: /baccalaureat|bac|bachelier|bac\s*\+?\s*0/i, level: "BAC" },
                { pattern: /brevet|bep|cap|befp/i, level: "BEPC" }
            ];
            
            for (const edu of educationPatterns) {
                if (edu.pattern.test(jobText)) {
                    return edu.level;
                }
            }
            
            return "Niveau non spécifié";
        }

        function preprocessText(text) {
            // Convertir en minuscules
            text = text.toLowerCase();
            
            // Supprimer les accents
            text = text.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            
            // Supprimer la ponctuation et les caractères spéciaux
            text = text.replace(/[^\w\s]/g, ' ');
            
            // Supprimer les stopwords (mots courants non informatifs en français)
            const stopwords = ['le', 'la', 'les', 'de', 'des', 'du', 'et', 'est', 'en', 'un', 'une', 'au', 'aux', 'dans', 'par', 'pour', 'sur', 'avec', 'son', 'ses', 'qui', 'que', 'quoi', 'quand', 'ou', 'comment', 'pourquoi', 'ce', 'cet', 'cette', 'ces', 'a', 'ans', 'annees', 'annee', 'ans', 'an', 'dans', 'par', 'pour', 'sur', 'avec', 'son', 'ses', 'qui', 'que', 'quoi', 'quand', 'ou', 'comment', 'pourquoi', 'ce', 'cet', 'cette', 'ces', 'a', 'ans', 'annees', 'annee', 'ans', 'an'];
            stopwords.forEach(word => {
                const regex = new RegExp('\\b' + word + '\\b', 'g');
                text = text.replace(regex, '');
            });
            
            // Supprimer les espaces multiples
            text = text.replace(/\s+/g, ' ').trim();
            
            return text;
        }

        function calculateCosineSimilarity(text1, text2) {
            // Créer un vocabulaire commun
            const words1 = text1.split(' ');
            const words2 = text2.split(' ');
            const allWords = [...new Set([...words1, ...words2])];
            
            // Vectoriser les textes
            const vector1 = allWords.map(word => words1.filter(w => w === word).length);
            const vector2 = allWords.map(word => words2.filter(w => w === word).length);
            
            // Calculer le produit scalaire
            let dotProduct = 0;
            for (let i = 0; i < allWords.length; i++) {
                dotProduct += vector1[i] * vector2[i];
            }
            
            // Calculer les magnitudes
            const magnitude1 = Math.sqrt(vector1.reduce((sum, val) => sum + val * val, 0));
            const magnitude2 = Math.sqrt(vector2.reduce((sum, val) => sum + val * val, 0));
            
            // Éviter la division par zéro
            if (magnitude1 === 0 || magnitude2 === 0) {
                return 0;
            }
            
            // Retourner la similarité cosinus
            return dotProduct / (magnitude1 * magnitude2);
        }

        function compareKeywords(cvKeywords, jobKeywords) {
            const matched = [];
            const missing = [];
            
            jobKeywords.forEach(keyword => {
                // Vérifier les correspondances exactes ou partielles
                const found = cvKeywords.some(cvKeyword => 
                    cvKeyword.includes(keyword) || keyword.includes(cvKeyword)
                );
                
                if (found) {
                    matched.push(keyword);
                } else {
                    missing.push(keyword);
                }
            });
            
            return { matched, missing };
        }

        function generateSuggestions(matched, missing, experience, educationLevel) {
            const suggestions = [];
            
            if (matched.length < 5) {
                suggestions.push("Votre CV manque de mots-clés importants pour ce poste. Essayez d'ajouter des compétences spécifiques mentionnées dans l'offre d'emploi.");
            }
            
            if (missing.length > 0) {
                suggestions.push(`Enrichissez votre CV avec les compétences suivantes: ${missing.slice(0, 5).join(', ')}.`);
            }
            
            if (experience < 2) {
                suggestions.push("Mettez en avant vos stages, projets personnels ou bénévolats pour compenser le manque d'expérience professionnelle.");
            }
            
            suggestions.push("Utilisez des verbes d'action pour décrire vos expériences (ex: développé, géré, optimisé, etc.).");
            suggestions.push("Ajoutez des chiffres et résultats concrets pour quantifier vos réalisations.");
            
            return suggestions;
        }

        function displayAnalysisResults(analysis) {
            // Mettre à jour le score
            document.querySelector('.circle-value').textContent = `${analysis.score}%`;
            document.querySelector('.circle').style.strokeDasharray = `${analysis.score}, 100`;
            
            // Afficher les mots-clés correspondants
            const matchedContainer = document.getElementById('matched-keywords');
            matchedContainer.innerHTML = '';
            if (analysis.matchedKeywords.length > 0) {
                analysis.matchedKeywords.slice(0, 10).forEach(keyword => {
                    const span = document.createElement('span');
                    span.className = 'keyword-match';
                    span.textContent = keyword;
                    matchedContainer.appendChild(span);
                });
            } else {
                matchedContainer.innerHTML = '<p>Aucun mot-clé correspondant trouvé.</p>';
            }
            
            // Afficher les mots-clés manquants
            const missingContainer = document.getElementById('missing-keywords');
            missingContainer.innerHTML = '';
            if (analysis.missingKeywords.length > 0) {
                analysis.missingKeywords.slice(0, 10).forEach(keyword => {
                    const span = document.createElement('span');
                    span.className = 'missing-keyword';
                    span.textContent = keyword;
                    missingContainer.appendChild(span);
                });
            } else {
                missingContainer.innerHTML = '<p>Tous les mots-clés importants sont présents dans votre CV.</p>';
            }
            
            // Afficher l'analyse détaillée
            const detailedContainer = document.getElementById('detailed-analysis');
            detailedContainer.innerHTML = `
                <p>📅 Expérience: <strong>${analysis.experience} ans</strong></p>
                <p>🎓 Niveau d'éducation: <strong>${analysis.educationLevel}</strong></p>
                <p>✅ Mots-clés correspondants: <strong>${analysis.matchedKeywords.length}</strong> sur ${analysis.matchedKeywords.length + analysis.missingKeywords.length}</p>
                <p>💼 Compétences identifiées: <strong>${analysis.cvInfo.skills.length}</strong></p>
                <p>🌐 Langues: <strong>${analysis.cvInfo.languages.join(', ') || 'Aucune spécifiée'}</strong></p>
            `;
            
            // Afficher les conseils
            const tipsContainer = document.getElementById('improvement-tips');
            tipsContainer.innerHTML = '';
            analysis.suggestions.forEach(tip => {
                const li = document.createElement('li');
                li.textContent = tip;
                tipsContainer.appendChild(li);
            });
            
            // Afficher les résultats
            document.getElementById('analyzer-result').classList.remove('hidden');
            
            // Scroll to results
            document.getElementById('analyzer-result').scrollIntoView({ behavior: 'smooth' });
        }

        function saveAnalysisResult() {
            if (!currentAnalysisResult || !currentJobIdForAnalysis) {
                alert("Veuillez d'abord analyser votre CV pour une offre d'emploi spécifique.");
                return;
            }
            
            // Enregistrer le score dans le localStorage (simulation de backend)
            const savedScores = JSON.parse(localStorage.getItem('cvScores') || '{}');
            savedScores[currentJobIdForAnalysis] = currentAnalysisResult.score;
            localStorage.setItem('cvScores', JSON.stringify(savedScores));
            
            // Enregistrer les résultats complets dans le localStorage
            const savedResults = JSON.parse(localStorage.getItem('cvAnalysisResults') || '{}');
            const jobKey = `job_${currentJobIdForAnalysis}_${Date.now()}`;
            savedResults[jobKey] = {
                jobId: currentJobIdForAnalysis,
                score: currentAnalysisResult.score,
                date: new Date().toISOString(),
                matchedKeywords: currentAnalysisResult.matchedKeywords,
                missingKeywords: currentAnalysisResult.missingKeywords
            };
            localStorage.setItem('cvAnalysisResults', JSON.stringify(savedResults));
            
            // Mettre à jour l'affichage des offres pour montrer le score
            renderJobs(filteredJobs);
            
            alert(`Résultat enregistré avec succès! Votre score de correspondance est de ${currentAnalysisResult.score}%.`);
        }
    </script>
</body>

</html>
